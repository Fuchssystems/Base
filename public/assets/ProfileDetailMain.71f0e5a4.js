import{Q as hr,a as ln,b as Ye}from"./QSkeleton.2cfd221f.js";import{Q as He}from"./QPageSticky.7346d663.js";import{Q as ht}from"./QPage.87d29655.js";import{br as xt,ab as un,ag as mt,bs as Et,bt as It,P as qe,R as gt,S as Je,bu as Dt,_ as De,ah as pe,V as k,W as B,X as _,Z as M,Y as y,al as H,am as xe,an as Ee,a0 as V,ak as j,aj as q,y as fn,ai as te,bv as dn,c as mr,d as A,e as D,bw as pn,k as hn,r as X,n as mn,C as Le,b7 as gn,b9 as vn,ba as yn,o as Cn,O as bn,t as rt,f as Sn,bx as Mt,by as Ot,bz as At,bA as jt,bB as Lt,bC as Bt,aW as _n,bo as gr,T as Tn,aR as Pn,a7 as Ke,bD as kn,bE as $t,a9 as Ut,a5 as Rn,bF as Ft,bG as Xe,bH as be,bI as xn,bJ as En,bK as In,af as Dn}from"./index.bf56c37c.js";import{Q as Mn}from"./QImg.aea93594.js";import{a as vr,Q as On,b as vt}from"./attributeOptions.42c2329a.js";import{Q as nt,a as An,b as it}from"./QCarouselControl.f0346412.js";import{E as yt}from"./ErrorRowCard.afd9eb8d.js";import{Q as yr,b as oe,a as ge}from"./QItemLabel.7710578a.js";import{Q as zt}from"./touch.1c117415.js";import{Q as jn}from"./QScrollObserver.48249fae.js";import{T as ot}from"./TouchPan.c1f73bcd.js";import{Q as Ln,a as Bn}from"./QToolbar.724cb3f3.js";import"./rtl.4b414a6d.js";import"./selection.5d5f1514.js";import"./use-fullscreen.51e29d29.js";import"./QList.a60f2ba5.js";const Ct=function(r){const t=new Date(`${r} UTC`);let n=t.toLocaleDateString(xt.t("app_locale_browser"),{day:"2-digit",month:"2-digit",year:"2-digit"});return n+=" ",n+=t.toLocaleTimeString(xt.t("app_locale_browser"),{hourCycle:"h23",hour:"2-digit",minute:"2-digit"}),n},$n={name:"ProfileDetailInfo",components:{"error-row-card":yt},data(){return{profileIdsToRemoveFromSelection:[],carouselProfileImagesFullscreen:!1,attributeOptions:vr,m:un,serverDateToLocalDateTimeString:Ct}},methods:{fetchSelectedProfileIdImages:mt.exports.throttle(function(){this.chatClearProfileImagesFetchResult(),this.getChatProfileImagesErrorList.length&&this.chatProfileImagesResetErrorlist(),this[Et]({profileId:this.getChatSelectedProfileId,token:this.getUserToken})},100),onProfileInput(e){this.chatSetSelectedProfileId(e),this.fetchSelectedProfileIdImages()},onButtonGotoPanel(e){const r=e==="next"?this.getChatSelectedProfileIndex+1:this.getChatSelectedProfileIndex-1;this.chatSetSelectedProfileId(this.getChatProfiles[r].id),this.fetchSelectedProfileIdImages()},onSliderProfileIndex(e){this.chatSetSelectedProfileId(this.getChatProfiles[e-1].id),this.fetchSelectedProfileIdImages()},onToggleIsContact(e){if(this[It]({thisProfileId:this.getUserActiveProfileId,profile:{...e,is_contact:!e.is_contact},token:this.getUserToken}),!this.getUserPreferenceChatSearchModeIsProfiles)if(e.is_contact)this.profileIdsToRemoveFromSelection.push(e.id);else{const r=this.profileIdsToRemoveFromSelection.findIndex(t=>t===e.id);r!==-1&&this.profileIdsToRemoveFromSelection.splice(r,1)}},...qe(["chatRemoveProfilesFromSelection","chatSetSelectedProfileId","chatSetSelectedProfileImageId","chatClearProfileImagesFetchResult","chatProfileImagesResetErrorlist"]),...gt([Et,Dt,It])},computed:{...Je(["getChatProfiles","getChatSelectedProfileId","getChatSelectedProfileIndex","getChatProfileImages","getChatProfileImagesIsFetching","getChatProfileImagesProfileIdSet","getChatProfileImagesSelectedId","getChatProfileImagesErrorList","getChatProfileImagesShowNoImagesFound","getUserActiveProfileId","getUserToken","getUserPreferenceChatSearchModeIsProfiles"])},mounted(){this.getChatSelectedProfileId!==this.getChatProfileImagesProfileIdSet&&this.fetchSelectedProfileIdImages()},beforeUnmount(){console.log("before destroy: this.profileIdsToRemoveFromSelection"),console.log(this.profileIdsToRemoveFromSelection),this.chatRemoveProfilesFromSelection(this.profileIdsToRemoveFromSelection),this[Dt]()}},Un={style:{"margin-top":"30px","margin-right":"6px","margin-left":"-19px",width:"100%","max-width":"600px"}},Fn={class:"row q-pa-sm",style:{width:"100%","max-width":"600px"}},zn={class:"col-3",style:{width:"160px"}},Vn={class:"col",style:{"margin-left":"12px"}},Nn={class:"text-h6"},wn={class:"text-body2",style:{"margin-top":"-4px","margin-left":"-6px"}},Gn={key:0,style:{"margin-top":"-2px"}},Hn={key:1,style:{"margin-top":"-2px"},class:"text-body2"},qn={key:2,style:{"margin-top":"-2px",height:"21px"}},Jn={class:"text-body2 q-mt-sm",style:{"margin-top":"5px"}},Wn={class:"text-bod2"},Qn={class:"row",style:{width:"100%","max-width":"600px"}},Yn={class:"col",style:{"margin-top":"6px","margin-left":"152px"}},Kn={class:"q-pr-sm",style:{"margin-left":"5px",width:"100%","max-width":"600px"}},Xn={key:0,class:"div-carousel"},Zn={key:1,class:"text-h6 q-mx-md text-blue-grey-8"},ei={class:"bg-primary",style:{width:"100%",height:"34px"}};function ti(e,r,t,n,i,o){const l=pe("error-row-card");return k(),B(ht,null,{default:_(()=>[M("div",Un,[y(nt,{swipeable:"",animated:"",ref:"carouselProfiles","model-value":e.getChatSelectedProfileId,"onUpdate:modelValue":o.onProfileInput,height:"197px"},{default:_(()=>[(k(!0),H(Ee,null,xe(e.getChatProfiles,a=>(k(),B(it,{key:a.id,name:a.id},{default:_(()=>[M("div",Fn,[M("div",zn,[y(Mn,{class:"rounded-borders",src:a.profile_image.filecontent},null,8,["src"])]),M("div",Vn,[M("div",Nn,q(a.name),1),M("div",wn,[y(fn,{name:i.attributeOptions[a.gender_male_female_diverse_null].icon,color:i.attributeOptions[a.gender_male_female_diverse_null].color,size:"sm"},null,8,["name","color"]),te(" "+q(`${a.ageYears} ${e.$t("app_word_years")}`)+" ",1),y(dn,{"model-value":!!a.is_contact,"onUpdate:modelValue":s=>o.onToggleIsContact(a),icon:i.attributeOptions.is_contact.icon,color:i.attributeOptions.is_contact.color},null,8,["model-value","onUpdate:modelValue","icon","color"])]),a.online?(k(),H("div",Gn,[y(vt,{color:"red"},{default:_(()=>[te(q(e.$t("profile_onlineStatus_online")),1)]),_:1})])):j("",!0),!a.online&&a.last_online?(k(),H("div",Hn,q(`${e.$t("profile_onlineStatus_last_online")} ${i.serverDateToLocalDateTimeString(a.last_online)}`),1)):j("",!0),!a.online&&!a.last_online?(k(),H("div",qn)):j("",!0),M("div",Jn,q(`${a.country_code_iso_3166_alpha_2}-${a.areacode} ${a.city}`),1),M("div",Wn,q(`${e.$t("app_word_distance")}: ${a.distance} km`),1)])])]),_:2},1032,["name"]))),128))]),_:1},8,["model-value","onUpdate:modelValue"]),M("div",Qn,[M("div",Yn,[y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",style:{"margin-right":"10px"},onClick:r[0]||(r[0]=a=>e.$router.go(-1))}),y(V,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_left",style:{"margin-right":"5px"},disabled:e.getChatSelectedProfileIndex===0,onClick:r[1]||(r[1]=a=>o.onButtonGotoPanel("previous"))},null,8,["disabled"]),y(V,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_right",disabled:e.getChatSelectedProfileIndex>=e.getChatProfiles.length-1,onClick:r[2]||(r[2]=a=>o.onButtonGotoPanel("next"))},null,8,["disabled"]),y(On,{min:1,max:e.getChatProfiles.length,color:"primary","model-value":e.getChatSelectedProfileIndex+1,"onUpdate:modelValue":o.onSliderProfileIndex,class:"vertical-top",style:{width:"60px",display:"inline-block",margin:"6px -30px -6px 20px","padding-right":"0px"},step:1,label:"","label-value":`${e.getChatSelectedProfileIndex+1}/${e.getChatProfiles.length}`,"label-always":""},null,8,["max","model-value","onUpdate:modelValue","label-value"])])])]),M("div",Kn,[e.getChatProfileImages.length?(k(),H("div",Xn,[y(nt,{swipeable:"",animated:"",arrows:e.getChatProfileImages.length>1,thumbnails:e.getChatProfileImages.length>1,"model-value":e.getChatProfileImagesSelectedId,fullscreen:i.carouselProfileImagesFullscreen,"onUpdate:fullscreen":r[4]||(r[4]=a=>i.carouselProfileImagesFullscreen=a),infinite:"","onUpdate:modelValue":e.chatSetSelectedProfileImageId,height:"480px"},{control:_(()=>[y(An,{position:"bottom-right",offset:[18,18]},{default:_(()=>[y(V,{push:"",round:"",dense:"",color:"white","text-color":"primary",icon:i.carouselProfileImagesFullscreen?"fullscreen_exit":"fullscreen",onClick:r[3]||(r[3]=a=>i.carouselProfileImagesFullscreen=!i.carouselProfileImagesFullscreen)},null,8,["icon"])]),_:1})]),default:_(()=>[(k(!0),H(Ee,null,xe(e.getChatProfileImages,a=>(k(),B(it,{image:a,key:a.id,name:a.id,"img-src":a.filecontent},null,8,["image","name","img-src"]))),128))]),_:1},8,["arrows","thumbnails","model-value","fullscreen","onUpdate:modelValue"])])):j("",!0)]),e.getChatProfileImagesIsFetching?(k(),B(hr,{key:0,height:"120px",class:"q-ma-sm",style:{width:"100%","max-width":"600px"}})):j("",!0),e.getChatProfileImagesShowNoImagesFound?(k(),H("div",Zn,q(i.m("app_search_message_no_recordnames",{recordname:"picture"})),1)):j("",!0),y(l,{errorList:e.getChatProfileImagesErrorList},null,8,["errorList"]),y(He,{expand:"",position:"bottom"},{default:_(()=>[M("div",ei,[y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"sm",style:{margin:"5px 0px 5px 16px"},onClick:r[5]||(r[5]=a=>e.$router.go(-1))})])]),_:1})]),_:1})}var ri=De($n,[["render",ti]]),ni=mr({name:"QChatMessage",props:{sent:Boolean,label:String,bgColor:String,textColor:String,name:String,avatar:String,text:Array,stamp:String,size:String,labelHtml:Boolean,nameHtml:Boolean,textHtml:Boolean,stampHtml:Boolean},setup(e,{slots:r}){const t=A(()=>e.sent===!0?"sent":"received"),n=A(()=>`q-message-text-content q-message-text-content--${t.value}`+(e.textColor!==void 0?` text-${e.textColor}`:"")),i=A(()=>`q-message-text q-message-text--${t.value}`+(e.bgColor!==void 0?` text-${e.bgColor}`:"")),o=A(()=>"q-message-container row items-end no-wrap"+(e.sent===!0?" reverse":"")),l=A(()=>e.size!==void 0?`col-${e.size}`:""),a=A(()=>({msg:e.textHtml===!0?"innerHTML":"textContent",stamp:e.stampHtml===!0?"innerHTML":"textContent",name:e.nameHtml===!0?"innerHTML":"textContent",label:e.labelHtml===!0?"innerHTML":"textContent"}));function s(u){return r.stamp!==void 0?[u,D("div",{class:"q-message-stamp"},r.stamp())]:e.stamp?[u,D("div",{class:"q-message-stamp",[a.value.stamp]:e.stamp})]:[u]}function c(u,f){const d=f===!0?u.length>1?h=>h:h=>D("div",[h]):h=>D("div",{[a.value.msg]:h});return u.map((h,p)=>D("div",{key:p,class:i.value},[D("div",{class:n.value},s(d(h)))]))}return()=>{const u=[];r.avatar!==void 0?u.push(r.avatar()):e.avatar!==void 0&&u.push(D("img",{class:`q-message-avatar q-message-avatar--${t.value}`,src:e.avatar,"aria-hidden":"true"}));const f=[];r.name!==void 0?f.push(D("div",{class:`q-message-name q-message-name--${t.value}`},r.name())):e.name!==void 0&&f.push(D("div",{class:`q-message-name q-message-name--${t.value}`,[a.value.name]:e.name})),r.default!==void 0?f.push(c(pn(r.default()),!0)):e.text!==void 0&&f.push(c(e.text)),u.push(D("div",{class:l.value},f));const d=[];return r.label!==void 0?d.push(D("div",{class:"q-message-label"},r.label())):e.label!==void 0&&d.push(D("div",{class:"q-message-label",[a.value.label]:e.label})),d.push(D("div",{class:o.value},u)),D("div",{class:`q-message q-message-${t.value}`},d)}}});const Vt=["vertical","horizontal"],Ze={vertical:{offset:"offsetY",scroll:"scrollTop",dir:"down",dist:"y"},horizontal:{offset:"offsetX",scroll:"scrollLeft",dir:"right",dist:"x"}},Nt={prevent:!0,mouse:!0,mouseAllDir:!0},wt=e=>e>=250?50:Math.ceil(e/5);var Cr=mr({name:"QScrollArea",props:{...hn,thumbStyle:Object,verticalThumbStyle:Object,horizontalThumbStyle:Object,barStyle:[Array,String,Object],verticalBarStyle:[Array,String,Object],horizontalBarStyle:[Array,String,Object],contentStyle:[Array,String,Object],contentActiveStyle:[Array,String,Object],delay:{type:[String,Number],default:1e3},visible:{type:Boolean,default:null},tabindex:[String,Number],onScroll:Function},setup(e,{slots:r,emit:t}){const n=X(!1),i=X(!1),o=X(!1),l={vertical:X(0),horizontal:X(0)},a={vertical:{ref:X(null),position:X(0),size:X(0)},horizontal:{ref:X(null),position:X(0),size:X(0)}},s=Sn(),c=mn(e,s.proxy.$q);let u,f;const d=X(null),h=A(()=>"q-scrollarea"+(c.value===!0?" q-scrollarea--dark":""));a.vertical.percentage=A(()=>{const v=a.vertical.size.value-l.vertical.value;if(v<=0)return 0;const T=Le(a.vertical.position.value/v,0,1);return Math.round(T*1e4)/1e4}),a.vertical.thumbHidden=A(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||a.vertical.size.value<=l.vertical.value+1),a.vertical.thumbStart=A(()=>a.vertical.percentage.value*(l.vertical.value-a.vertical.thumbSize.value)),a.vertical.thumbSize=A(()=>Math.round(Le(l.vertical.value*l.vertical.value/a.vertical.size.value,wt(l.vertical.value),l.vertical.value))),a.vertical.style=A(()=>({...e.thumbStyle,...e.verticalThumbStyle,top:`${a.vertical.thumbStart.value}px`,height:`${a.vertical.thumbSize.value}px`})),a.vertical.thumbClass=A(()=>"q-scrollarea__thumb q-scrollarea__thumb--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.vertical.barClass=A(()=>"q-scrollarea__bar q-scrollarea__bar--v absolute-right"+(a.vertical.thumbHidden.value===!0?" q-scrollarea__bar--invisible":"")),a.horizontal.percentage=A(()=>{const v=a.horizontal.size.value-l.horizontal.value;if(v<=0)return 0;const T=Le(a.horizontal.position.value/v,0,1);return Math.round(T*1e4)/1e4}),a.horizontal.thumbHidden=A(()=>(e.visible===null?o.value:e.visible)!==!0&&n.value===!1&&i.value===!1||a.horizontal.size.value<=l.horizontal.value+1),a.horizontal.thumbStart=A(()=>a.horizontal.percentage.value*(l.horizontal.value-a.horizontal.thumbSize.value)),a.horizontal.thumbSize=A(()=>Math.round(Le(l.horizontal.value*l.horizontal.value/a.horizontal.size.value,wt(l.horizontal.value),l.horizontal.value))),a.horizontal.style=A(()=>({...e.thumbStyle,...e.horizontalThumbStyle,left:`${a.horizontal.thumbStart.value}px`,width:`${a.horizontal.thumbSize.value}px`})),a.horizontal.thumbClass=A(()=>"q-scrollarea__thumb q-scrollarea__thumb--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__thumb--invisible":"")),a.horizontal.barClass=A(()=>"q-scrollarea__bar q-scrollarea__bar--h absolute-bottom"+(a.horizontal.thumbHidden.value===!0?" q-scrollarea__bar--invisible":""));const p=A(()=>a.vertical.thumbHidden.value===!0&&a.horizontal.thumbHidden.value===!0?e.contentStyle:e.contentActiveStyle),m=[[ot,v=>{F(v,"vertical")},void 0,{vertical:!0,...Nt}]],E=[[ot,v=>{F(v,"horizontal")},void 0,{horizontal:!0,...Nt}]];function C(){const v={};return Vt.forEach(T=>{const R=a[T];v[T+"Position"]=R.position.value,v[T+"Percentage"]=R.percentage.value,v[T+"Size"]=R.size.value,v[T+"ContainerSize"]=l[T].value}),v}const b=gn(()=>{const v=C();v.ref=s.proxy,t("scroll",v)},0);function U(v,T,R){if(Vt.includes(v)===!1){console.error("[QScrollArea]: wrong first param of setScrollPosition (vertical/horizontal)");return}(v==="vertical"?Mt:Ot)(d.value,T,R)}function O({height:v,width:T}){let R=!1;l.vertical.value!==v&&(l.vertical.value=v,R=!0),l.horizontal.value!==T&&(l.horizontal.value=T,R=!0),R===!0&&le()}function I({position:v}){let T=!1;a.vertical.position.value!==v.top&&(a.vertical.position.value=v.top,T=!0),a.horizontal.position.value!==v.left&&(a.horizontal.position.value=v.left,T=!0),T===!0&&le()}function W({height:v,width:T}){a.horizontal.size.value!==T&&(a.horizontal.size.value=T,le()),a.vertical.size.value!==v&&(a.vertical.size.value=v,le())}function F(v,T){const R=a[T];if(v.isFirst===!0){if(R.thumbHidden.value===!0)return;f=R.position.value,i.value=!0}else if(i.value!==!0)return;v.isFinal===!0&&(i.value=!1);const re=Ze[T],ue=l[T].value,Ce=(R.size.value-ue)/(ue-R.thumbSize.value),Ae=v.distance[re.dist],je=f+(v.direction===re.dir?1:-1)*Ae*Ce;se(je,T)}function $(v,T){const R=a[T];if(R.thumbHidden.value!==!0){const re=v[Ze[T].offset];if(re<R.thumbStart.value||re>R.thumbStart.value+R.thumbSize.value){const ue=re-R.thumbSize.value/2;se(ue/l[T].value*R.size.value,T)}R.ref.value!==null&&R.ref.value.dispatchEvent(new MouseEvent(v.type,v))}}function Oe(v){$(v,"vertical")}function P(v){$(v,"horizontal")}function le(){n.value===!0?clearTimeout(u):n.value=!0,u=setTimeout(()=>{n.value=!1},e.delay),e.onScroll!==void 0&&b()}function se(v,T){d.value[Ze[T].scroll]=v}function ye(){o.value=!0}function Z(){o.value=!1}Object.assign(s.proxy,{getScrollTarget:()=>d.value,getScroll:C,getScrollPosition:()=>({top:a.vertical.position.value,left:a.horizontal.position.value}),getScrollPercentage:()=>({top:a.vertical.percentage.value,left:a.horizontal.percentage.value}),setScrollPosition:U,setScrollPercentage(v,T,R){U(v,T*(a[v].size.value-l[v].value),R)}});let ce=null;return vn(()=>{ce={top:a.vertical.position.value,left:a.horizontal.position.value}}),yn(()=>{if(ce===null)return;const v=d.value;v!==null&&(Ot(v,ce.left),Mt(v,ce.top))}),Cn(b.cancel),()=>D("div",{class:h.value,onMouseenter:ye,onMouseleave:Z},[D("div",{ref:d,class:"q-scrollarea__container scroll relative-position fit hide-scrollbar",tabindex:e.tabindex!==void 0?e.tabindex:void 0},[D("div",{class:"q-scrollarea__content absolute",style:p.value},bn(r.default,[D(zt,{debounce:0,onResize:W})])),D(jn,{axis:"both",onScroll:I})]),D(zt,{debounce:0,onResize:O}),D("div",{class:a.vertical.barClass.value,style:[e.barStyle,e.verticalBarStyle],"aria-hidden":"true",onMousedown:Oe}),D("div",{class:a.horizontal.barClass.value,style:[e.barStyle,e.horizontalBarStyle],"aria-hidden":"true",onMousedown:P}),rt(D("div",{ref:a.vertical.ref,class:a.vertical.thumbClass.value,style:a.vertical.style.value,"aria-hidden":"true"}),m),rt(D("div",{ref:a.horizontal.ref,class:a.horizontal.thumbClass.value,style:a.horizontal.style.value,"aria-hidden":"true"}),E)])}});const ii={name:"ProfileDetailChat",components:{"error-row-card":yt},data(){return{messageToSend:"",thumbStyle:{right:"4px",borderRadius:"5px",backgroundColor:"#027be3",width:"5px",opacity:.75},barStyle:{right:"2px",borderRadius:"9px",backgroundColor:"#027be3",width:"9px",opacity:.2},attributeOptions:vr,serverDateToLocalDateTimeString:Ct}},methods:{fetchSelectedProfileIdChatMessages(){this.chatClearChatMessagesFetchResult(),this.getChatChatMessagesErrorList.length&&this.chatchatMessagesResetErrorlist(),this[At]({profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,token:this.getUserToken})},onProfileInput(e){this.chatSetSelectedProfileId(e),this.fetchSelectedProfileIdChatMessages()},onButtonGotoPanel(e){const r=e==="next"?this.getChatSelectedProfileIndex+1:this.getChatSelectedProfileIndex-1;this.chatSetSelectedProfileId(this.getChatProfiles[r].id),this.fetchSelectedProfileIdChatMessages()},onChatMessageSend(){const e=new Date().getTime();this.chatChatMessageSend({type:"chatChatMessageSend",profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,messageText:this.messageToSend,temporaryMessageId:e}),this.getChatChatMessagesErrorList.length&&this.chatchatMessagesResetErrorlist(),this[jt]({message:{profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,messageText:this.messageToSend},temporaryMessageId:e,token:this.getUserToken}),this.messageToSend=""},onKeyDownMessageToSend(){this.getChatSelectedProfile&&this.getChatSelectedProfile.online&&this.debouncedSendIsWriting()},...qe(["chatSetSelectedProfileId","chatClearChatMessagesFetchResult","chatchatMessagesResetErrorlist","chatChatMessageSend","chatSetScrollMessagesDown"]),...gt([jt,At,Bt,Lt])},computed:{...Je(["getChatChatMessagesErrorList","getChatChatMessages","getChatChatMessagesIsFetching","getChatChatMessagesProfileIdSet","getChatSelectedProfile","getChatSetScrollMessagesDown","getChatProfiles","getChatSelectedProfileId","getChatSelectedProfileIndex","getChatProfileSetIsWriting","getUserActiveProfileId","getUserToken"])},updated(){this.getChatSetScrollMessagesDown&&setTimeout(()=>{this.$refs.messages&&(this.$refs.messages.setScrollPercentage("vertical",1),this.chatSetScrollMessagesDown({scrollDownValue:!1}))},500)},mounted(){this.getChatSelectedProfileId!==this.getChatChatMessagesProfileIdSet&&this.fetchSelectedProfileIdChatMessages(),this.debouncedSendIsWriting=mt.exports.debounce(()=>{this[Lt]({type:"isWriting",profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId})},3e3,{leading:!0,trailing:!1})},beforeUnmount(){this[Bt](),this.chatClearChatMessagesFetchResult()}},oi={class:"row"},ai=["src"],si={class:"row"},ci={class:"row"},li={class:"bg-primary",style:{width:"100%",height:"44px"}};function ui(e,r,t,n,i,o){const l=pe("error-row-card");return k(),B(ht,{class:"q-pa-sm",style:{"margin-top":"50px"}},{default:_(()=>[M("div",oi,[y(nt,{class:"col",style:{margin:"-20px -30px",width:"100%","max-width":"400px"},swipeable:"",animated:"",ref:"carouselProfiles","model-value":e.getChatSelectedProfileId,"onUpdate:modelValue":o.onProfileInput,height:"100px"},{default:_(()=>[(k(!0),H(Ee,null,xe(e.getChatProfiles,a=>(k(),B(it,{key:a.id,name:a.id},{default:_(()=>[y(yr,null,{default:_(()=>[y(oe,{side:"",left:""},{default:_(()=>[y(V,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_left",disabled:e.getChatSelectedProfileIndex===0,onClick:r[0]||(r[0]=s=>o.onButtonGotoPanel("previous"))},null,8,["disabled"])]),_:1}),y(oe,{avatar:""},{default:_(()=>[y(gr,{rounded:""},{default:_(()=>[M("img",{src:a.profile_image.filecontent},null,8,ai)]),_:2},1024)]),_:2},1024),y(oe,null,{default:_(()=>[y(ge,null,{default:_(()=>[te(q(a.name),1)]),_:2},1024),!a.online&&a.last_online?(k(),B(ge,{key:0,caption:"",class:"text-body2 q-mt-sm"},{default:_(()=>[te(q(`${e.$t("profile_onlineStatus_last_online")} ${i.serverDateToLocalDateTimeString(a.last_online)}`),1)]),_:2},1024)):j("",!0)]),_:2},1024),a.online?(k(),B(oe,{key:0,side:"",top:""},{default:_(()=>[y(vt,{class:"q-mb-sm",color:"red"},{default:_(()=>[te(q(e.$t("profile_onlineStatus_online")),1)]),_:1}),y(Tn,{name:"fade"},{default:_(()=>[e.getChatProfileSetIsWriting?(k(),B(ge,{key:0,class:"text-body2 text-green"},{default:_(()=>[te(q(e.$t("chat_message_isWriting")),1)]),_:1})):j("",!0)]),_:1})]),_:1})):j("",!0),y(oe,{side:"",right:""},{default:_(()=>[y(V,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_right",disabled:e.getChatSelectedProfileIndex>=e.getChatProfiles.length-1,onClick:r[1]||(r[1]=s=>o.onButtonGotoPanel("next"))},null,8,["disabled"])]),_:1})]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["model-value","onUpdate:modelValue"])]),M("div",si,[e.getChatChatMessagesIsFetching?j("",!0):(k(),B(Cr,{key:0,class:"col q-mb-md q-pa-sm col bg-light-blue-1",style:{height:"calc(100vh - 372px)",width:"100%","max-width":"340px"},"thumb-style":i.thumbStyle,"bar-style":i.barStyle,ref:"messages"},{default:_(()=>[(k(!0),H(Ee,null,xe(e.getChatChatMessages,a=>(k(),H("div",{class:"q-pa-xs",key:a.id},[y(ni,{text:[a.messageText],stamp:a.send_at?i.serverDateToLocalDateTimeString(a.send_at):"",sent:a.profile_id_sender==e.getUserActiveProfileId,"bg-color":a.profile_id_sender===e.getUserActiveProfileId?"amber-2":"light-green-2"},null,8,["text","stamp","sent","bg-color"])]))),128))]),_:1},8,["thumb-style","bar-style"])),e.getChatChatMessagesIsFetching?(k(),B(hr,{key:1,height:"calc(100vh - 372px)",class:"q-mb-md q-pa-sm",style:{width:"100%","max-width":"340px"}})):j("",!0)]),y(l,{errorList:e.getChatChatMessagesErrorList},null,8,["errorList"]),M("div",ci,[y(_n,{modelValue:i.messageToSend,"onUpdate:modelValue":r[2]||(r[2]=a=>i.messageToSend=a),class:"col",style:{width:"100%","max-width":"340px"},type:"textarea",filled:"",placeholder:e.$t("chat_field_messageToSend_placeholder"),onKeydown:o.onKeyDownMessageToSend},{append:_(()=>[y(V,{round:"",dense:"",flat:"",icon:"send",disabled:!i.messageToSend,onClick:o.onChatMessageSend},null,8,["disabled","onClick"])]),_:1},8,["modelValue","placeholder","onKeydown"])]),y(He,{expand:"",position:"bottom"},{default:_(()=>[M("div",li,[y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:r[3]||(r[3]=a=>e.$router.go(-1))})])]),_:1})]),_:1})}var fi=De(ii,[["render",ui],["__scopeId","data-v-14e8f2fe"]]);const di={name:"ConsoleLogCard",props:{logArray:Array},emits:["onClearDebugConsole","onCloseDebugConsole"],watch:{logArray(){this.$refs.scrollArea.setScrollPercentage("vertical",1)}}},pi={class:"row"},hi=te("Log");function mi(e,r,t,n,i,o){return k(),H("div",pi,[y(Pn,{flat:"",bordered:"",class:"consolelog-card q-mt-md bg-info"},{default:_(()=>[y(Ln,{class:"bg-blue-2"},{default:_(()=>[y(Bn,null,{default:_(()=>[hi]),_:1}),y(V,{push:"",round:"",color:"blue-grey-8","text-color":"white",disabled:!t.logArray.length,icon:"clear_all",size:"sm",onClick:r[0]||(r[0]=l=>e.$emit("onClearDebugConsole"))},null,8,["disabled"]),y(V,{push:"",round:"",color:"blue-grey-8","text-color":"white",style:{"margin-left":"10px"},icon:"close",size:"sm",onClick:r[1]||(r[1]=l=>e.$emit("onCloseDebugConsole"))})]),_:1}),y(Cr,{ref:"scrollArea",style:{height:"200px",width:"100%"}},{default:_(()=>[(k(!0),H(Ee,null,xe(t.logArray,(l,a)=>(k(),H("div",{key:a,class:"q-my-xs text-caption consolelog-item"},q(l),1))),128))]),_:1},512)]),_:1})])}var gi=De(di,[["render",mi]]),bt={exports:{}};(function(e){var r={};r.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),r.useArrayBufferView=!r.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),e.exports.binaryFeatures=r;var t=e.exports.BlobBuilder;typeof window!="undefined"&&(t=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function n(){this._pieces=[],this._parts=[]}n.prototype.append=function(i){typeof i=="number"?this._pieces.push(i):(this.flush(),this._parts.push(i))},n.prototype.flush=function(){if(this._pieces.length>0){var i=new Uint8Array(this._pieces);r.useArrayBufferView||(i=i.buffer),this._parts.push(i),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),r.useBlobBuilder){for(var i=new t,o=0,l=this._parts.length;o<l;o++)i.append(this._parts[o]);return i.getBlob()}else return new Blob(this._parts)},e.exports.BufferBuilder=n})(bt);var vi=bt.exports.BufferBuilder,Gt=bt.exports.binaryFeatures,yi={unpack:function(e){var r=new N(e);return r.unpack()},pack:function(e){var r=new w;r.pack(e);var t=r.getBuffer();return t}},Ht=yi;function N(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}N.prototype.unpack=function(){var e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;var r;if((r=e^160)<=15)return this.unpack_raw(r);if((r=e^176)<=15)return this.unpack_string(r);if((r=e^144)<=15)return this.unpack_array(r);if((r=e^128)<=15)return this.unpack_map(r);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}};N.prototype.unpack_uint8=function(){var e=this.dataView[this.index]&255;return this.index++,e};N.prototype.unpack_uint16=function(){var e=this.read(2),r=(e[0]&255)*256+(e[1]&255);return this.index+=2,r};N.prototype.unpack_uint32=function(){var e=this.read(4),r=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,r};N.prototype.unpack_uint64=function(){var e=this.read(8),r=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,r};N.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-(1<<8)};N.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-(1<<16)};N.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)};N.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)};N.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var r=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,r};N.prototype.unpack_string=function(e){for(var r=this.read(e),t=0,n="",i,o;t<e;)i=r[t],i<128?(n+=String.fromCharCode(i),t++):(i^192)<32?(o=(i^192)<<6|r[t+1]&63,n+=String.fromCharCode(o),t+=2):(o=(i&15)<<12|(r[t+1]&63)<<6|r[t+2]&63,n+=String.fromCharCode(o),t+=3);return this.index+=e,n};N.prototype.unpack_array=function(e){for(var r=new Array(e),t=0;t<e;t++)r[t]=this.unpack();return r};N.prototype.unpack_map=function(e){for(var r={},t=0;t<e;t++){var n=this.unpack(),i=this.unpack();r[n]=i}return r};N.prototype.unpack_float=function(){var e=this.unpack_uint32(),r=e>>31,t=(e>>23&255)-127,n=e&8388607|8388608;return(r===0?1:-1)*n*Math.pow(2,t-23)};N.prototype.unpack_double=function(){var e=this.unpack_uint32(),r=this.unpack_uint32(),t=e>>31,n=(e>>20&2047)-1023,i=e&1048575|1048576,o=i*Math.pow(2,n-20)+r*Math.pow(2,n-52);return(t===0?1:-1)*o};N.prototype.read=function(e){var r=this.index;if(r+e<=this.length)return this.dataView.subarray(r,r+e);throw new Error("BinaryPackFailure: read index out of range")};function w(){this.bufferBuilder=new vi}w.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};w.prototype.pack=function(e){var r=typeof e;if(r==="string")this.pack_string(e);else if(r==="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(r==="boolean")e===!0?this.bufferBuilder.append(195):e===!1&&this.bufferBuilder.append(194);else if(r==="undefined")this.bufferBuilder.append(192);else if(r==="object")if(e===null)this.bufferBuilder.append(192);else{var t=e.constructor;if(t==Array)this.pack_array(e);else if(t==Blob||t==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(t==ArrayBuffer)Gt.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)Gt.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(e);else if(t==Date)this.pack_string(e.toString());else if(typeof e.toBinaryPack=="function")this.bufferBuilder.append(e.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+r+'" not yet supported');this.bufferBuilder.flush()};w.prototype.pack_bin=function(e){var r=e.length||e.byteLength||e.size;if(r<=15)this.pack_uint8(160+r);else if(r<=65535)this.bufferBuilder.append(218),this.pack_uint16(r);else if(r<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(r);else throw new Error("Invalid length");this.bufferBuilder.append(e)};w.prototype.pack_string=function(e){var r=bi(e);if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this.bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this.bufferBuilder.append(e)};w.prototype.pack_array=function(e){var r=e.length;if(r<=15)this.pack_uint8(144+r);else if(r<=65535)this.bufferBuilder.append(220),this.pack_uint16(r);else if(r<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(r);else throw new Error("Invalid length");for(var t=0;t<r;t++)this.pack(e[t])};w.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(e&255);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")};w.prototype.pack_double=function(e){var r=0;e<0&&(r=1,e=-e);var t=Math.floor(Math.log(e)/Math.LN2),n=e/Math.pow(2,t)-1,i=Math.floor(n*Math.pow(2,52)),o=Math.pow(2,32),l=r<<31|t+1023<<20|i/o&1048575,a=i%o;this.bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(a)};w.prototype.pack_object=function(e){var r=Object.keys(e),t=r.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var n in e)e.hasOwnProperty(n)&&(this.pack(n),this.pack(e[n]))};w.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)};w.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(e&255)};w.prototype.pack_uint32=function(e){var r=e&4294967295;this.bufferBuilder.append((r&4278190080)>>>24),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255)};w.prototype.pack_uint64=function(e){var r=e/Math.pow(2,32),t=e%Math.pow(2,32);this.bufferBuilder.append((r&4278190080)>>>24),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};w.prototype.pack_int8=function(e){this.bufferBuilder.append(e&255)};w.prototype.pack_int16=function(e){this.bufferBuilder.append((e&65280)>>8),this.bufferBuilder.append(e&255)};w.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};w.prototype.pack_int64=function(e){var r=Math.floor(e/Math.pow(2,32)),t=e%Math.pow(2,32);this.bufferBuilder.append((r&4278190080)>>>24),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function Ci(e){var r=e.charCodeAt(0);return r<=2047?"00":r<=65535?"000":r<=2097151?"0000":r<=67108863?"00000":"000000"}function bi(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,Ci).length}let br=!0,Sr=!0;function Te(e,r,t){const n=e.match(r);return n&&n.length>=t&&parseInt(n[t],10)}function ve(e,r,t){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(l,a){if(l!==r)return i.apply(this,arguments);const s=c=>{const u=t(c);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(a,s),i.apply(this,[l,s])};const o=n.removeEventListener;n.removeEventListener=function(l,a){if(l!==r||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);if(!this._eventMap[r].has(a))return o.apply(this,arguments);const s=this._eventMap[r].get(a);return this._eventMap[r].delete(a),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[l,s])},Object.defineProperty(n,"on"+r,{get(){return this["_on"+r]},set(l){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),l&&this.addEventListener(r,this["_on"+r]=l)},enumerable:!0,configurable:!0})}function Si(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(br=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function _i(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(Sr=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function St(){if(typeof window=="object"){if(br)return;typeof console!="undefined"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function We(e,r){!Sr||console.warn(e+" is deprecated, please use "+r+" instead.")}function Ti(e){const r={browser:null,version:null};if(typeof e=="undefined"||!e.navigator)return r.browser="Not a browser.",r;const{navigator:t}=e;if(t.mozGetUserMedia)r.browser="firefox",r.version=Te(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=Te(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=Te(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(e.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))r.browser="safari",r.version=Te(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return r.browser="Not a supported browser.",r;return r}function qt(e){return Object.prototype.toString.call(e)==="[object Object]"}function _r(e){return qt(e)?Object.keys(e).reduce(function(r,t){const n=qt(e[t]),i=n?_r(e[t]):e[t],o=n&&!Object.keys(i).length;return i===void 0||o?r:Object.assign(r,{[t]:i})},{}):e}function at(e,r,t){!r||t.has(r.id)||(t.set(r.id,r),Object.keys(r).forEach(n=>{n.endsWith("Id")?at(e,e.get(r[n]),t):n.endsWith("Ids")&&r[n].forEach(i=>{at(e,e.get(i),t)})}))}function Jt(e,r,t){const n=t?"outbound-rtp":"inbound-rtp",i=new Map;if(r===null)return i;const o=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===r.id&&o.push(l)}),o.forEach(l=>{e.forEach(a=>{a.type===n&&a.trackId===l.id&&at(e,a,i)})}),i}const Wt=St;function Tr(e,r){const t=e&&e.navigator;if(!t.mediaDevices)return;const n=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const s={};return Object.keys(a).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const u=typeof a[c]=="object"?a[c]:{ideal:a[c]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const f=function(d,h){return d?d+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(u.ideal!==void 0){s.optional=s.optional||[];let d={};typeof u.ideal=="number"?(d[f("min",c)]=u.ideal,s.optional.push(d),d={},d[f("max",c)]=u.ideal,s.optional.push(d)):(d[f("",c)]=u.ideal,s.optional.push(d))}u.exact!==void 0&&typeof u.exact!="number"?(s.mandatory=s.mandatory||{},s.mandatory[f("",c)]=u.exact):["min","max"].forEach(d=>{u[d]!==void 0&&(s.mandatory=s.mandatory||{},s.mandatory[f(d,c)]=u[d])})}),a.advanced&&(s.optional=(s.optional||[]).concat(a.advanced)),s},i=function(a,s){if(r.version>=61)return s(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const c=function(u,f,d){f in u&&!(d in u)&&(u[d]=u[f],delete u[f])};a=JSON.parse(JSON.stringify(a)),c(a.audio,"autoGainControl","googAutoGainControl"),c(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=n(a.audio)}if(a&&typeof a.video=="object"){let c=a.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const u=r.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let f;if(c.exact==="environment"||c.ideal==="environment"?f=["back","rear"]:(c.exact==="user"||c.ideal==="user")&&(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(d=>{d=d.filter(p=>p.kind==="videoinput");let h=d.find(p=>f.some(m=>p.label.toLowerCase().includes(m)));return!h&&d.length&&f.includes("back")&&(h=d[d.length-1]),h&&(a.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),a.video=n(a.video),Wt("chrome: "+JSON.stringify(a)),s(a)})}a.video=n(a.video)}return Wt("chrome: "+JSON.stringify(a)),s(a)},o=function(a){return r.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},l=function(a,s,c){i(a,u=>{t.webkitGetUserMedia(u,s,f=>{c&&c(o(f))})})};if(t.getUserMedia=l.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(s){return i(s,c=>a(c).then(u=>{if(c.audio&&!u.getAudioTracks().length||c.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function Pi(e,r){if(!(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)&&!!e.navigator.mediaDevices){if(typeof r!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}e.navigator.mediaDevices.getDisplayMedia=function(n){return r(n).then(i=>{const o=n.video&&n.video.width,l=n.video&&n.video.height,a=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:a||3}},o&&(n.video.mandatory.maxWidth=o),l&&(n.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(n)})}}}function Pr(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function kr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",i=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===i.track.id):o={track:i.track};const l=new Event("track");l.track=i.track,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)}),n.stream.getTracks().forEach(i=>{let o;e.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(a=>a.track&&a.track.id===i.id):o={track:i};const l=new Event("track");l.track=i,l.receiver=o,l.transceiver={receiver:o},l.streams=[n.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else ve(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function Rr(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,s){let c=i.apply(this,arguments);return c||(c=r(this,a),this._senders.push(c)),c};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){o.apply(this,arguments);const s=this._senders.indexOf(a);s!==-1&&this._senders.splice(s,1)}}const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(l=>{this._senders.push(r(this,l))})};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(l=>{const a=this._senders.find(s=>s.track===l);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xr(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,o]=arguments;if(arguments.length>0&&typeof n=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof n!="function"))return r.apply(this,[]);const l=function(s){const c={};return s.result().forEach(f=>{const d={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(h=>{d[h]=f.stat(h)}),c[d.id]=d}),c},a=function(s){return new Map(Object.keys(s).map(c=>[c,s[c]]))};if(arguments.length>=2){const s=function(c){i(a(l(c)))};return r.apply(this,[s,n])}return new Promise((s,c)=>{r.apply(this,[function(u){s(a(l(u)))},c])}).then(i,o)}}function Er(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(l=>l._pc=this),o});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(l=>Jt(l,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i}),ve(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Jt(o,i.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,o,l;return this.getSenders().forEach(a=>{a.track===n&&(i?l=!0:i=a)}),this.getReceivers().forEach(a=>(a.track===n&&(o?l=!0:o=a),a.track===n)),l||i&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function Ir(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,a){if(!a)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const s=r.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(s)===-1&&this._shimmedLocalStreams[a.id].push(s):this._shimmedLocalStreams[a.id]=[a,s],s};const t=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(c=>{if(this.getSenders().find(f=>f.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const s=this.getSenders().filter(c=>a.indexOf(c)===-1);this._shimmedLocalStreams[l.id]=[l].concat(s)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],n.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const s=this._shimmedLocalStreams[a].indexOf(l);s!==-1&&this._shimmedLocalStreams[a].splice(s,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),i.apply(this,arguments)}}function Dr(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return Ir(e);const t=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(f=>this._reverseStreams[f.id])};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(f=>{if(this.getSenders().find(h=>h.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const f=new e.MediaStream(u.getTracks());this._streams[u.id]=f,this._reverseStreams[f.id]=u,u=f}n.apply(this,[u])};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[f.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new e.MediaStream([u]);this._streams[f.id]=m,this._reverseStreams[m.id]=f,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function o(c,u){let f=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const h=c._reverseStreams[d],p=c._streams[h.id];f=f.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:u.type,sdp:f})}function l(c,u){let f=u.sdp;return Object.keys(c._reverseStreams||[]).forEach(d=>{const h=c._reverseStreams[d],p=c._streams[h.id];f=f.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:f})}["createOffer","createAnswer"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],f={[c](){const d=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const m=o(this,p);d[0].apply(null,[m])},p=>{d[1]&&d[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>o(this,p))}};e.RTCPeerConnection.prototype[c]=f[c]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=l(this,arguments[0]),a.apply(this,arguments))};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const c=s.get.apply(this);return c.type===""?c:o(this,c)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let d;Object.keys(this._streams).forEach(h=>{this._streams[h].getTracks().find(m=>u.track===m)&&(d=this._streams[h])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function st(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),!!e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=i[t]})}function Mr(e,r){ve(e,"negotiationneeded",t=>{const n=t.target;if(!((r.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}var Qt=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:Pr,shimOnTrack:kr,shimGetSendersWithDtmf:Rr,shimGetStats:xr,shimSenderReceiverGetStats:Er,shimAddTrackRemoveTrackWithNative:Ir,shimAddTrackRemoveTrack:Dr,shimPeerConnection:st,fixNegotiationNeeded:Mr,shimGetUserMedia:Tr,shimGetDisplayMedia:Pi},Symbol.toStringTag,{value:"Module"}));function ki(e,r){let t=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(n=>{if(n&&(n.urls||n.url)){let i=n.urls||n.url;n.url&&!n.urls&&We("RTCIceServer.url","RTCIceServer.urls");const o=typeof i=="string";return o&&(i=[i]),i=i.filter(l=>{if(l.indexOf("stun:")===0)return!1;const a=l.startsWith("turn")&&!l.startsWith("turn:[")&&l.includes("transport=udp");return a&&!t?(t=!0,!0):a&&!t}),delete n.url,n.urls=o?i[0]:i,!!i.length}})}var _t={exports:{}};(function(e){var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(t){return t.trim().split(`
`).map(function(n){return n.trim()})},r.splitSections=function(t){var n=t.split(`
m=`);return n.map(function(i,o){return(o>0?"m="+i:i).trim()+`\r
`})},r.getDescription=function(t){var n=r.splitSections(t);return n&&n[0]},r.getMediaSections=function(t){var n=r.splitSections(t);return n.shift(),n},r.matchPrefix=function(t,n){return r.splitLines(t).filter(function(i){return i.indexOf(n)===0})},r.parseCandidate=function(t){var n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");for(var i={foundation:n[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},o=8;o<n.length;o+=2)switch(n[o]){case"raddr":i.relatedAddress=n[o+1];break;case"rport":i.relatedPort=parseInt(n[o+1],10);break;case"tcptype":i.tcpType=n[o+1];break;case"ufrag":i.ufrag=n[o+1],i.usernameFragment=n[o+1];break;default:i[n[o]]=n[o+1];break}return i},r.writeCandidate=function(t){var n=[];n.push(t.foundation),n.push(t.component),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);var i=t.type;return n.push("typ"),n.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},r.parseIceOptions=function(t){return t.substr(14).split(" ")},r.parseRtpMap=function(t){var n=t.substr(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},r.writeRtpMap=function(t){var n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);var i=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},r.parseExtmap=function(t){var n=t.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},r.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},r.parseFmtp=function(t){for(var n={},i,o=t.substr(t.indexOf(" ")+1).split(";"),l=0;l<o.length;l++)i=o[l].trim().split("="),n[i[0].trim()]=i[1];return n},r.writeFmtp=function(t){var n="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var o=[];Object.keys(t.parameters).forEach(function(l){t.parameters[l]?o.push(l+"="+t.parameters[l]):o.push(l)}),n+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return n},r.parseRtcpFb=function(t){var n=t.substr(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},r.writeRtcpFb=function(t){var n="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(o){n+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},r.parseSsrcMedia=function(t){var n=t.indexOf(" "),i={ssrc:parseInt(t.substr(7,n-7),10)},o=t.indexOf(":",n);return o>-1?(i.attribute=t.substr(n+1,o-n-1),i.value=t.substr(o+1)):i.attribute=t.substr(n+1),i},r.parseSsrcGroup=function(t){var n=t.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(i){return parseInt(i,10)})}},r.getMid=function(t){var n=r.matchPrefix(t,"a=mid:")[0];if(n)return n.substr(6)},r.parseFingerprint=function(t){var n=t.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},r.getDtlsParameters=function(t,n){var i=r.matchPrefix(t+n,"a=fingerprint:");return{role:"auto",fingerprints:i.map(r.parseFingerprint)}},r.writeDtlsParameters=function(t,n){var i="a=setup:"+n+`\r
`;return t.fingerprints.forEach(function(o){i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},r.parseCryptoLine=function(t){var n=t.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},r.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?r.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var n=t.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},r.getCryptoParameters=function(t,n){var i=r.matchPrefix(t+n,"a=crypto:");return i.map(r.parseCryptoLine)},r.getIceParameters=function(t,n){var i=r.matchPrefix(t+n,"a=ice-ufrag:")[0],o=r.matchPrefix(t+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substr(12),password:o.substr(10)}:null},r.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},r.parseRtpParameters=function(t){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=r.splitLines(t),o=i[0].split(" "),l=3;l<o.length;l++){var a=o[l],s=r.matchPrefix(t,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),u=r.matchPrefix(t,"a=fmtp:"+a+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(t,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),n.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(c.name.toUpperCase());break}}}return r.matchPrefix(t,"a=extmap:").forEach(function(f){n.headerExtensions.push(r.parseExtmap(f))}),n},r.writeRtpDescription=function(t,n){var i="";i+="m="+t+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map(function(l){return l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType}).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(function(l){i+=r.writeRtpMap(l),i+=r.writeFmtp(l),i+=r.writeRtcpFb(l)});var o=0;return n.codecs.forEach(function(l){l.maxptime>o&&(o=l.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),i+=`a=rtcp-mux\r
`,n.headerExtensions&&n.headerExtensions.forEach(function(l){i+=r.writeExtmap(l)}),i},r.parseRtpEncodingParameters=function(t){var n=[],i=r.parseRtpParameters(t),o=i.fecMechanisms.indexOf("RED")!==-1,l=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=r.matchPrefix(t,"a=ssrc:").map(function(d){return r.parseSsrcMedia(d)}).filter(function(d){return d.attribute==="cname"}),s=a.length>0&&a[0].ssrc,c,u=r.matchPrefix(t,"a=ssrc-group:FID").map(function(d){var h=d.substr(17).split(" ");return h.map(function(p){return parseInt(p,10)})});u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),i.codecs.forEach(function(d){if(d.name.toUpperCase()==="RTX"&&d.parameters.apt){var h={ssrc:s,codecPayloadType:parseInt(d.parameters.apt,10)};s&&c&&(h.rtx={ssrc:c}),n.push(h),o&&(h=JSON.parse(JSON.stringify(h)),h.fec={ssrc:s,mechanism:l?"red+ulpfec":"red"},n.push(h))}}),n.length===0&&s&&n.push({ssrc:s});var f=r.matchPrefix(t,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substr(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substr(5),10)*1e3*.95-50*40*8:f=void 0,n.forEach(function(d){d.maxBitrate=f})),n},r.parseRtcpParameters=function(t){var n={},i=r.matchPrefix(t,"a=ssrc:").map(function(a){return r.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var o=r.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;var l=r.matchPrefix(t,"a=rtcp-mux");return n.mux=l.length>0,n},r.parseMsid=function(t){var n,i=r.matchPrefix(t,"a=msid:");if(i.length===1)return n=i[0].substr(7).split(" "),{stream:n[0],track:n[1]};var o=r.matchPrefix(t,"a=ssrc:").map(function(l){return r.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="msid"});if(o.length>0)return n=o[0].value.split(" "),{stream:n[0],track:n[1]}},r.parseSctpDescription=function(t){var n=r.parseMLine(t),i=r.matchPrefix(t,"a=max-message-size:"),o;i.length>0&&(o=parseInt(i[0].substr(19),10)),isNaN(o)&&(o=65536);var l=r.matchPrefix(t,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substr(12),10),protocol:n.fmt,maxMessageSize:o};var a=r.matchPrefix(t,"a=sctpmap:");if(a.length>0){var s=r.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:o}}},r.writeSctpDescription=function(t,n){var i=[];return t.protocol!=="DTLS/SCTP"?i=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:i=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(t,n,i){var o,l=n!==void 0?n:2;t?o=t:o=r.generateSessionId();var a=i||"thisisadapterortc";return`v=0\r
o=`+a+" "+o+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.writeMediaSection=function(t,n,i,o){var l=r.writeRtpDescription(t.kind,n);if(l+=r.writeIceParameters(t.iceGatherer.getLocalParameters()),l+=r.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),i==="offer"?"actpass":"active"),l+="a=mid:"+t.mid+`\r
`,t.direction?l+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?l+=`a=sendrecv\r
`:t.rtpSender?l+=`a=sendonly\r
`:t.rtpReceiver?l+=`a=recvonly\r
`:l+=`a=inactive\r
`,t.rtpSender){var a="msid:"+o.id+" "+t.rtpSender.track.id+`\r
`;l+="a="+a,l+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,l+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return l+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(l+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+`\r
`),l},r.getDirection=function(t,n){for(var i=r.splitLines(t),o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substr(2)}return n?r.getDirection(n):"sendrecv"},r.getKind=function(t){var n=r.splitLines(t),i=n[0].split(" ");return i[0].substr(2)},r.isRejected=function(t){return t.split(" ",2)[1]==="0"},r.parseMLine=function(t){var n=r.splitLines(t),i=n[0].substr(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},r.parseOLine=function(t){var n=r.matchPrefix(t,"o=")[0],i=n.substr(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},r.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var n=r.splitLines(t),i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},e.exports=r})(_t);var Fe=_t.exports,S=_t.exports;function Ri(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function Yt(e,r,t,n,i){var o=S.writeRtpDescription(e.kind,r);if(o+=S.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=S.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":i||"active"),o+="a=mid:"+e.mid+`\r
`,e.rtpSender&&e.rtpReceiver?o+=`a=sendrecv\r
`:e.rtpSender?o+=`a=sendonly\r
`:e.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,e.rtpSender){var l=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=l;var a="msid:"+(n?n.id:"-")+" "+l+`\r
`;o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+S.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+S.localCName+`\r
`),o}function xi(e,r){var t=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(n){if(n&&(n.urls||n.url)){var i=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof i=="string";return o&&(i=[i]),i=i.filter(function(l){var a=l.indexOf("turn:")===0&&l.indexOf("transport=udp")!==-1&&l.indexOf("turn:[")===-1&&!t;return a?(t=!0,!0):l.indexOf("stun:")===0&&r>=14393&&l.indexOf("?transport=udp")===-1}),delete n.url,n.urls=o?i[0]:i,!!i.length}})}function Be(e,r){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(o,l){o=parseInt(o,10);for(var a=0;a<l.length;a++)if(l[a].payloadType===o||l[a].preferredPayloadType===o)return l[a]},i=function(o,l,a,s){var c=n(o.parameters.apt,a),u=n(l.parameters.apt,s);return c&&u&&c.name.toLowerCase()===u.name.toLowerCase()};return e.codecs.forEach(function(o){for(var l=0;l<r.codecs.length;l++){var a=r.codecs[l];if(o.name.toLowerCase()===a.name.toLowerCase()&&o.clockRate===a.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&a.parameters.apt&&!i(o,a,e.codecs,r.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(o.numChannels,a.numChannels),t.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(s){for(var c=0;c<o.rtcpFeedback.length;c++)if(o.rtcpFeedback[c].type===s.type&&o.rtcpFeedback[c].parameter===s.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(o){for(var l=0;l<r.headerExtensions.length;l++){var a=r.headerExtensions[l];if(o.uri===a.uri){t.headerExtensions.push(a);break}}}),t}function Kt(e,r,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[r][e].indexOf(t)!==-1}function et(e,r){var t=e.getRemoteCandidates().find(function(n){return r.foundation===n.foundation&&r.ip===n.ip&&r.port===n.port&&r.priority===n.priority&&r.protocol===n.protocol&&r.type===n.type});return t||e.addRemoteCandidate(r),!t}function G(e,r){var t=new Error(r);return t.name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}var Ei=function(e,r){function t(s,c){c.addTrack(s),c.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:s}))}function n(s,c){c.removeTrack(s),c.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:s}))}function i(s,c,u,f){var d=new Event("track");d.track=c,d.receiver=u,d.transceiver={receiver:u},d.streams=f,e.setTimeout(function(){s._dispatchEvent("track",d)})}var o=function(s){var c=this,u=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(d){c[d]=u[d].bind(u)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",s=JSON.parse(JSON.stringify(s||{})),this.usingBundle=s.bundlePolicy==="max-bundle",s.rtcpMuxPolicy==="negotiate")throw G("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(s.rtcpMuxPolicy||(s.rtcpMuxPolicy="require"),s.iceTransportPolicy){case"all":case"relay":break;default:s.iceTransportPolicy="all";break}switch(s.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:s.bundlePolicy="balanced";break}if(s.iceServers=xi(s.iceServers||[],r),this._iceGatherers=[],s.iceCandidatePoolSize)for(var f=s.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:s.iceServers,gatherPolicy:s.iceTransportPolicy}));else s.iceCandidatePoolSize=0;this._config=s,this.transceivers=[],this._sdpSessionId=S.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(s,c){this._isClosed||(this.dispatchEvent(c),typeof this["on"+s]=="function"&&this["on"+s](c))},o.prototype._emitGatheringStateChange=function(){var s=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",s)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(s,c){var u=this.transceivers.length>0,f={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:s,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&u)f.iceTransport=this.transceivers[0].iceTransport,f.dtlsTransport=this.transceivers[0].dtlsTransport;else{var d=this._createIceAndDtlsTransports();f.iceTransport=d.iceTransport,f.dtlsTransport=d.dtlsTransport}return c||this.transceivers.push(f),f},o.prototype.addTrack=function(s,c){if(this._isClosed)throw G("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var u=this.transceivers.find(function(h){return h.track===s});if(u)throw G("InvalidAccessError","Track already exists.");for(var f,d=0;d<this.transceivers.length;d++)!this.transceivers[d].track&&this.transceivers[d].kind===s.kind&&(f=this.transceivers[d]);return f||(f=this._createTransceiver(s.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(c)===-1&&this.localStreams.push(c),f.track=s,f.stream=c,f.rtpSender=new e.RTCRtpSender(s,f.dtlsTransport),f.rtpSender},o.prototype.addStream=function(s){var c=this;if(r>=15025)s.getTracks().forEach(function(f){c.addTrack(f,s)});else{var u=s.clone();s.getTracks().forEach(function(f,d){var h=u.getTracks()[d];f.addEventListener("enabled",function(p){h.enabled=p.enabled})}),u.getTracks().forEach(function(f){c.addTrack(f,u)})}},o.prototype.removeTrack=function(s){if(this._isClosed)throw G("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(s instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var c=this.transceivers.find(function(d){return d.rtpSender===s});if(!c)throw G("InvalidAccessError","Sender was not created by this connection.");var u=c.stream;c.rtpSender.stop(),c.rtpSender=null,c.track=null,c.stream=null;var f=this.transceivers.map(function(d){return d.stream});f.indexOf(u)===-1&&this.localStreams.indexOf(u)>-1&&this.localStreams.splice(this.localStreams.indexOf(u),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(s){var c=this;s.getTracks().forEach(function(u){var f=c.getSenders().find(function(d){return d.track===u});f&&c.removeTrack(f)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(s){return!!s.rtpSender}).map(function(s){return s.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(s){return!!s.rtpReceiver}).map(function(s){return s.rtpReceiver})},o.prototype._createIceGatherer=function(s,c){var u=this;if(c&&s>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[s].bufferedCandidateEvents=[],this.transceivers[s].bufferCandidates=function(d){var h=!d.candidate||Object.keys(d.candidate).length===0;f.state=h?"completed":"gathering",u.transceivers[s].bufferedCandidateEvents!==null&&u.transceivers[s].bufferedCandidateEvents.push(d)},f.addEventListener("localcandidate",this.transceivers[s].bufferCandidates),f},o.prototype._gather=function(s,c){var u=this,f=this.transceivers[c].iceGatherer;if(!f.onlocalcandidate){var d=this.transceivers[c].bufferedCandidateEvents;this.transceivers[c].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[c].bufferCandidates),f.onlocalcandidate=function(h){if(!(u.usingBundle&&c>0)){var p=new Event("icecandidate");p.candidate={sdpMid:s,sdpMLineIndex:c};var m=h.candidate,E=!m||Object.keys(m).length===0;if(E)(f.state==="new"||f.state==="gathering")&&(f.state="completed");else{f.state==="new"&&(f.state="gathering"),m.component=1,m.ufrag=f.getLocalParameters().usernameFragment;var C=S.writeCandidate(m);p.candidate=Object.assign(p.candidate,S.parseCandidate(C)),p.candidate.candidate=C,p.candidate.toJSON=function(){return{candidate:p.candidate.candidate,sdpMid:p.candidate.sdpMid,sdpMLineIndex:p.candidate.sdpMLineIndex,usernameFragment:p.candidate.usernameFragment}}}var b=S.getMediaSections(u._localDescription.sdp);E?b[p.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[p.candidate.sdpMLineIndex]+="a="+p.candidate.candidate+`\r
`,u._localDescription.sdp=S.getDescription(u._localDescription.sdp)+b.join("");var U=u.transceivers.every(function(O){return O.iceGatherer&&O.iceGatherer.state==="completed"});u.iceGatheringState!=="gathering"&&(u.iceGatheringState="gathering",u._emitGatheringStateChange()),E||u._dispatchEvent("icecandidate",p),U&&(u._dispatchEvent("icecandidate",new Event("icecandidate")),u.iceGatheringState="complete",u._emitGatheringStateChange())}},e.setTimeout(function(){d.forEach(function(h){f.onlocalcandidate(h)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var s=this,c=new e.RTCIceTransport(null);c.onicestatechange=function(){s._updateIceConnectionState(),s._updateConnectionState()};var u=new e.RTCDtlsTransport(c);return u.ondtlsstatechange=function(){s._updateConnectionState()},u.onerror=function(){Object.defineProperty(u,"state",{value:"failed",writable:!0}),s._updateConnectionState()},{iceTransport:c,dtlsTransport:u}},o.prototype._disposeIceAndDtlsTransports=function(s){var c=this.transceivers[s].iceGatherer;c&&(delete c.onlocalcandidate,delete this.transceivers[s].iceGatherer);var u=this.transceivers[s].iceTransport;u&&(delete u.onicestatechange,delete this.transceivers[s].iceTransport);var f=this.transceivers[s].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[s].dtlsTransport)},o.prototype._transceive=function(s,c,u){var f=Be(s.localCapabilities,s.remoteCapabilities);c&&s.rtpSender&&(f.encodings=s.sendEncodingParameters,f.rtcp={cname:S.localCName,compound:s.rtcpParameters.compound},s.recvEncodingParameters.length&&(f.rtcp.ssrc=s.recvEncodingParameters[0].ssrc),s.rtpSender.send(f)),u&&s.rtpReceiver&&f.codecs.length>0&&(s.kind==="video"&&s.recvEncodingParameters&&r<15019&&s.recvEncodingParameters.forEach(function(d){delete d.rtx}),s.recvEncodingParameters.length?f.encodings=s.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:s.rtcpParameters.compound},s.rtcpParameters.cname&&(f.rtcp.cname=s.rtcpParameters.cname),s.sendEncodingParameters.length&&(f.rtcp.ssrc=s.sendEncodingParameters[0].ssrc),s.rtpReceiver.receive(f))},o.prototype.setLocalDescription=function(s){var c=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(G("TypeError",'Unsupported type "'+s.type+'"'));if(!Kt("setLocalDescription",s.type,c.signalingState)||c._isClosed)return Promise.reject(G("InvalidStateError","Can not set local "+s.type+" in state "+c.signalingState));var u,f;if(s.type==="offer")u=S.splitSections(s.sdp),f=u.shift(),u.forEach(function(h,p){var m=S.parseRtpParameters(h);c.transceivers[p].localCapabilities=m}),c.transceivers.forEach(function(h,p){c._gather(h.mid,p)});else if(s.type==="answer"){u=S.splitSections(c._remoteDescription.sdp),f=u.shift();var d=S.matchPrefix(f,"a=ice-lite").length>0;u.forEach(function(h,p){var m=c.transceivers[p],E=m.iceGatherer,C=m.iceTransport,b=m.dtlsTransport,U=m.localCapabilities,O=m.remoteCapabilities,I=S.isRejected(h)&&S.matchPrefix(h,"a=bundle-only").length===0;if(!I&&!m.rejected){var W=S.getIceParameters(h,f),F=S.getDtlsParameters(h,f);d&&(F.role="server"),(!c.usingBundle||p===0)&&(c._gather(m.mid,p),C.state==="new"&&C.start(E,W,d?"controlling":"controlled"),b.state==="new"&&b.start(F));var $=Be(U,O);c._transceive(m,$.codecs.length>0,!1)}})}return c._localDescription={type:s.type,sdp:s.sdp},s.type==="offer"?c._updateSignalingState("have-local-offer"):c._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(s){var c=this;if(["offer","answer"].indexOf(s.type)===-1)return Promise.reject(G("TypeError",'Unsupported type "'+s.type+'"'));if(!Kt("setRemoteDescription",s.type,c.signalingState)||c._isClosed)return Promise.reject(G("InvalidStateError","Can not set remote "+s.type+" in state "+c.signalingState));var u={};c.remoteStreams.forEach(function(C){u[C.id]=C});var f=[],d=S.splitSections(s.sdp),h=d.shift(),p=S.matchPrefix(h,"a=ice-lite").length>0,m=S.matchPrefix(h,"a=group:BUNDLE ").length>0;c.usingBundle=m;var E=S.matchPrefix(h,"a=ice-options:")[0];return E?c.canTrickleIceCandidates=E.substr(14).split(" ").indexOf("trickle")>=0:c.canTrickleIceCandidates=!1,d.forEach(function(C,b){var U=S.splitLines(C),O=S.getKind(C),I=S.isRejected(C)&&S.matchPrefix(C,"a=bundle-only").length===0,W=U[0].substr(2).split(" ")[2],F=S.getDirection(C,h),$=S.parseMsid(C),Oe=S.getMid(C)||S.generateIdentifier();if(I||O==="application"&&(W==="DTLS/SCTP"||W==="UDP/DTLS/SCTP")){c.transceivers[b]={mid:Oe,kind:O,protocol:W,rejected:!0};return}!I&&c.transceivers[b]&&c.transceivers[b].rejected&&(c.transceivers[b]=c._createTransceiver(O,!0));var P,le,se,ye,Z,ce,v,T,R,re=S.parseRtpParameters(C),ue,Ce;I||(ue=S.getIceParameters(C,h),Ce=S.getDtlsParameters(C,h),Ce.role="client"),v=S.parseRtpEncodingParameters(C);var Ae=S.parseRtcpParameters(C),je=S.matchPrefix(C,"a=end-of-candidates",h).length>0,he=S.matchPrefix(C,"a=candidate:").map(function(Y){return S.parseCandidate(Y)}).filter(function(Y){return Y.component===1});if((s.type==="offer"||s.type==="answer")&&!I&&m&&b>0&&c.transceivers[b]&&(c._disposeIceAndDtlsTransports(b),c.transceivers[b].iceGatherer=c.transceivers[0].iceGatherer,c.transceivers[b].iceTransport=c.transceivers[0].iceTransport,c.transceivers[b].dtlsTransport=c.transceivers[0].dtlsTransport,c.transceivers[b].rtpSender&&c.transceivers[b].rtpSender.setTransport(c.transceivers[0].dtlsTransport),c.transceivers[b].rtpReceiver&&c.transceivers[b].rtpReceiver.setTransport(c.transceivers[0].dtlsTransport)),s.type==="offer"&&!I){P=c.transceivers[b]||c._createTransceiver(O),P.mid=Oe,P.iceGatherer||(P.iceGatherer=c._createIceGatherer(b,m)),he.length&&P.iceTransport.state==="new"&&(je&&(!m||b===0)?P.iceTransport.setRemoteCandidates(he):he.forEach(function(Y){et(P.iceTransport,Y)})),T=e.RTCRtpReceiver.getCapabilities(O),r<15019&&(T.codecs=T.codecs.filter(function(Y){return Y.name!=="rtx"})),ce=P.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var Qe=!1;if(F==="sendrecv"||F==="sendonly"){if(Qe=!P.rtpReceiver,Z=P.rtpReceiver||new e.RTCRtpReceiver(P.dtlsTransport,O),Qe){var me;R=Z.track,$&&$.stream==="-"||($?(u[$.stream]||(u[$.stream]=new e.MediaStream,Object.defineProperty(u[$.stream],"id",{get:function(){return $.stream}})),Object.defineProperty(R,"id",{get:function(){return $.track}}),me=u[$.stream]):(u.default||(u.default=new e.MediaStream),me=u.default)),me&&(t(R,me),P.associatedRemoteMediaStreams.push(me)),f.push([R,Z,me])}}else P.rtpReceiver&&P.rtpReceiver.track&&(P.associatedRemoteMediaStreams.forEach(function(Y){var Rt=Y.getTracks().find(function(cn){return cn.id===P.rtpReceiver.track.id});Rt&&n(Rt,Y)}),P.associatedRemoteMediaStreams=[]);P.localCapabilities=T,P.remoteCapabilities=re,P.rtpReceiver=Z,P.rtcpParameters=Ae,P.sendEncodingParameters=ce,P.recvEncodingParameters=v,c._transceive(c.transceivers[b],!1,Qe)}else if(s.type==="answer"&&!I){P=c.transceivers[b],le=P.iceGatherer,se=P.iceTransport,ye=P.dtlsTransport,Z=P.rtpReceiver,ce=P.sendEncodingParameters,T=P.localCapabilities,c.transceivers[b].recvEncodingParameters=v,c.transceivers[b].remoteCapabilities=re,c.transceivers[b].rtcpParameters=Ae,he.length&&se.state==="new"&&((p||je)&&(!m||b===0)?se.setRemoteCandidates(he):he.forEach(function(Y){et(P.iceTransport,Y)})),(!m||b===0)&&(se.state==="new"&&se.start(le,ue,"controlling"),ye.state==="new"&&ye.start(Ce));var an=Be(P.localCapabilities,P.remoteCapabilities),sn=an.codecs.filter(function(Y){return Y.name.toLowerCase()==="rtx"}).length;!sn&&P.sendEncodingParameters[0].rtx&&delete P.sendEncodingParameters[0].rtx,c._transceive(P,F==="sendrecv"||F==="recvonly",F==="sendrecv"||F==="sendonly"),Z&&(F==="sendrecv"||F==="sendonly")?(R=Z.track,$?(u[$.stream]||(u[$.stream]=new e.MediaStream),t(R,u[$.stream]),f.push([R,Z,u[$.stream]])):(u.default||(u.default=new e.MediaStream),t(R,u.default),f.push([R,Z,u.default]))):delete P.rtpReceiver}}),c._dtlsRole===void 0&&(c._dtlsRole=s.type==="offer"?"active":"passive"),c._remoteDescription={type:s.type,sdp:s.sdp},s.type==="offer"?c._updateSignalingState("have-remote-offer"):c._updateSignalingState("stable"),Object.keys(u).forEach(function(C){var b=u[C];if(b.getTracks().length){if(c.remoteStreams.indexOf(b)===-1){c.remoteStreams.push(b);var U=new Event("addstream");U.stream=b,e.setTimeout(function(){c._dispatchEvent("addstream",U)})}f.forEach(function(O){var I=O[0],W=O[1];b.id===O[2].id&&i(c,I,W,[b])})}}),f.forEach(function(C){C[2]||i(c,C[0],C[1],[])}),e.setTimeout(function(){!(c&&c.transceivers)||c.transceivers.forEach(function(C){C.iceTransport&&C.iceTransport.state==="new"&&C.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),C.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(s){s.iceTransport&&s.iceTransport.stop(),s.dtlsTransport&&s.dtlsTransport.stop(),s.rtpSender&&s.rtpSender.stop(),s.rtpReceiver&&s.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(s){this.signalingState=s;var c=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",c)},o.prototype._maybeFireNegotiationNeeded=function(){var s=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,e.setTimeout(function(){if(s.needNegotiation){s.needNegotiation=!1;var c=new Event("negotiationneeded");s._dispatchEvent("negotiationneeded",c)}},0))},o.prototype._updateIceConnectionState=function(){var s,c={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&!f.rejected&&c[f.iceTransport.state]++}),s="new",c.failed>0?s="failed":c.checking>0?s="checking":c.disconnected>0?s="disconnected":c.new>0?s="new":c.connected>0?s="connected":c.completed>0&&(s="completed"),s!==this.iceConnectionState){this.iceConnectionState=s;var u=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",u)}},o.prototype._updateConnectionState=function(){var s,c={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){f.iceTransport&&f.dtlsTransport&&!f.rejected&&(c[f.iceTransport.state]++,c[f.dtlsTransport.state]++)}),c.connected+=c.completed,s="new",c.failed>0?s="failed":c.connecting>0?s="connecting":c.disconnected>0?s="disconnected":c.new>0?s="new":c.connected>0&&(s="connected"),s!==this.connectionState){this.connectionState=s;var u=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",u)}},o.prototype.createOffer=function(){var s=this;if(s._isClosed)return Promise.reject(G("InvalidStateError","Can not call createOffer after close"));var c=s.transceivers.filter(function(p){return p.kind==="audio"}).length,u=s.transceivers.filter(function(p){return p.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(f.offerToReceiveAudio===!0?c=1:f.offerToReceiveAudio===!1?c=0:c=f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(f.offerToReceiveVideo===!0?u=1:f.offerToReceiveVideo===!1?u=0:u=f.offerToReceiveVideo)}for(s.transceivers.forEach(function(p){p.kind==="audio"?(c--,c<0&&(p.wantReceive=!1)):p.kind==="video"&&(u--,u<0&&(p.wantReceive=!1))});c>0||u>0;)c>0&&(s._createTransceiver("audio"),c--),u>0&&(s._createTransceiver("video"),u--);var d=S.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.transceivers.forEach(function(p,m){var E=p.track,C=p.kind,b=p.mid||S.generateIdentifier();p.mid=b,p.iceGatherer||(p.iceGatherer=s._createIceGatherer(m,s.usingBundle));var U=e.RTCRtpSender.getCapabilities(C);r<15019&&(U.codecs=U.codecs.filter(function(I){return I.name!=="rtx"})),U.codecs.forEach(function(I){I.name==="H264"&&I.parameters["level-asymmetry-allowed"]===void 0&&(I.parameters["level-asymmetry-allowed"]="1"),p.remoteCapabilities&&p.remoteCapabilities.codecs&&p.remoteCapabilities.codecs.forEach(function(W){I.name.toLowerCase()===W.name.toLowerCase()&&I.clockRate===W.clockRate&&(I.preferredPayloadType=W.payloadType)})}),U.headerExtensions.forEach(function(I){var W=p.remoteCapabilities&&p.remoteCapabilities.headerExtensions||[];W.forEach(function(F){I.uri===F.uri&&(I.id=F.id)})});var O=p.sendEncodingParameters||[{ssrc:(2*m+1)*1001}];E&&r>=15019&&C==="video"&&!O[0].rtx&&(O[0].rtx={ssrc:O[0].ssrc+1}),p.wantReceive&&(p.rtpReceiver=new e.RTCRtpReceiver(p.dtlsTransport,C)),p.localCapabilities=U,p.sendEncodingParameters=O}),s._config.bundlePolicy!=="max-compat"&&(d+="a=group:BUNDLE "+s.transceivers.map(function(p){return p.mid}).join(" ")+`\r
`),d+=`a=ice-options:trickle\r
`,s.transceivers.forEach(function(p,m){d+=Yt(p,p.localCapabilities,"offer",p.stream,s._dtlsRole),d+=`a=rtcp-rsize\r
`,p.iceGatherer&&s.iceGatheringState!=="new"&&(m===0||!s.usingBundle)&&(p.iceGatherer.getLocalCandidates().forEach(function(E){E.component=1,d+="a="+S.writeCandidate(E)+`\r
`}),p.iceGatherer.state==="completed"&&(d+=`a=end-of-candidates\r
`))});var h=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(h)},o.prototype.createAnswer=function(){var s=this;if(s._isClosed)return Promise.reject(G("InvalidStateError","Can not call createAnswer after close"));if(!(s.signalingState==="have-remote-offer"||s.signalingState==="have-local-pranswer"))return Promise.reject(G("InvalidStateError","Can not call createAnswer in signalingState "+s.signalingState));var c=S.writeSessionBoilerplate(s._sdpSessionId,s._sdpSessionVersion++);s.usingBundle&&(c+="a=group:BUNDLE "+s.transceivers.map(function(d){return d.mid}).join(" ")+`\r
`),c+=`a=ice-options:trickle\r
`;var u=S.getMediaSections(s._remoteDescription.sdp).length;s.transceivers.forEach(function(d,h){if(!(h+1>u)){if(d.rejected){d.kind==="application"?d.protocol==="DTLS/SCTP"?c+=`m=application 0 DTLS/SCTP 5000\r
`:c+="m=application 0 "+d.protocol+` webrtc-datachannel\r
`:d.kind==="audio"?c+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:d.kind==="video"&&(c+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),c+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+d.mid+`\r
`;return}if(d.stream){var p;d.kind==="audio"?p=d.stream.getAudioTracks()[0]:d.kind==="video"&&(p=d.stream.getVideoTracks()[0]),p&&r>=15019&&d.kind==="video"&&!d.sendEncodingParameters[0].rtx&&(d.sendEncodingParameters[0].rtx={ssrc:d.sendEncodingParameters[0].ssrc+1})}var m=Be(d.localCapabilities,d.remoteCapabilities),E=m.codecs.filter(function(C){return C.name.toLowerCase()==="rtx"}).length;!E&&d.sendEncodingParameters[0].rtx&&delete d.sendEncodingParameters[0].rtx,c+=Yt(d,m,"answer",d.stream,s._dtlsRole),d.rtcpParameters&&d.rtcpParameters.reducedSize&&(c+=`a=rtcp-rsize\r
`)}});var f=new e.RTCSessionDescription({type:"answer",sdp:c});return Promise.resolve(f)},o.prototype.addIceCandidate=function(s){var c=this,u;return s&&!(s.sdpMLineIndex!==void 0||s.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,d){if(c._remoteDescription)if(!s||s.candidate==="")for(var h=0;h<c.transceivers.length&&!(!c.transceivers[h].rejected&&(c.transceivers[h].iceTransport.addRemoteCandidate({}),u=S.getMediaSections(c._remoteDescription.sdp),u[h]+=`a=end-of-candidates\r
`,c._remoteDescription.sdp=S.getDescription(c._remoteDescription.sdp)+u.join(""),c.usingBundle));h++);else{var p=s.sdpMLineIndex;if(s.sdpMid){for(var m=0;m<c.transceivers.length;m++)if(c.transceivers[m].mid===s.sdpMid){p=m;break}}var E=c.transceivers[p];if(E){if(E.rejected)return f();var C=Object.keys(s.candidate).length>0?S.parseCandidate(s.candidate):{};if(C.protocol==="tcp"&&(C.port===0||C.port===9)||C.component&&C.component!==1)return f();if((p===0||p>0&&E.iceTransport!==c.transceivers[0].iceTransport)&&!et(E.iceTransport,C))return d(G("OperationError","Can not add ICE candidate"));var b=s.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),u=S.getMediaSections(c._remoteDescription.sdp),u[p]+="a="+(C.type?b:"end-of-candidates")+`\r
`,c._remoteDescription.sdp=S.getDescription(c._remoteDescription.sdp)+u.join("")}else return d(G("OperationError","Can not add ICE candidate"))}else return d(G("InvalidStateError","Can not add ICE candidate without a remote description"));f()})},o.prototype.getStats=function(s){if(s&&s instanceof e.MediaStreamTrack){var c=null;if(this.transceivers.forEach(function(f){f.rtpSender&&f.rtpSender.track===s?c=f.rtpSender:f.rtpReceiver&&f.rtpReceiver.track===s&&(c=f.rtpReceiver)}),!c)throw G("InvalidAccessError","Invalid selector.");return c.getStats()}var u=[];return this.transceivers.forEach(function(f){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(d){f[d]&&u.push(f[d].getStats())})}),Promise.all(u).then(function(f){var d=new Map;return f.forEach(function(h){h.forEach(function(p){d.set(p.id,p)})}),d})};var l=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];l.forEach(function(s){var c=e[s];if(c&&c.prototype&&c.prototype.getStats){var u=c.prototype.getStats;c.prototype.getStats=function(){return u.apply(this).then(function(f){var d=new Map;return Object.keys(f).forEach(function(h){f[h].type=Ri(f[h]),d.set(h,f[h])}),d})}}});var a=["createOffer","createAnswer"];return a.forEach(function(s){var c=o.prototype[s];o.prototype[s]=function(){var u=arguments;return typeof u[0]=="function"||typeof u[1]=="function"?c.apply(this,[arguments[2]]).then(function(f){typeof u[0]=="function"&&u[0].apply(null,[f])},function(f){typeof u[1]=="function"&&u[1].apply(null,[f])}):c.apply(this,arguments)}}),a=["setLocalDescription","setRemoteDescription","addIceCandidate"],a.forEach(function(s){var c=o.prototype[s];o.prototype[s]=function(){var u=arguments;return typeof u[1]=="function"||typeof u[2]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)},function(f){typeof u[2]=="function"&&u[2].apply(null,[f])}):c.apply(this,arguments)}}),["getStats"].forEach(function(s){var c=o.prototype[s];o.prototype[s]=function(){var u=arguments;return typeof u[1]=="function"?c.apply(this,arguments).then(function(){typeof u[1]=="function"&&u[1].apply(null)}):c.apply(this,arguments)}}),o};function Or(e){const r=e&&e.navigator,t=function(i){return{name:{PermissionDeniedError:"NotAllowedError"}[i.name]||i.name,message:i.message,constraint:i.constraint,toString(){return this.name}}},n=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(i){return n(i).catch(o=>Promise.reject(t(o)))}}function Ar(e){"getDisplayMedia"in e.navigator&&(!e.navigator.mediaDevices||e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}function ct(e,r){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(i){return i}),e.RTCSessionDescription||(e.RTCSessionDescription=function(i){return i}),r.version<15025)){const n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set(i){n.set.call(this,i);const o=new Event("enabled");o.enabled=i,this.dispatchEvent(o)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new e.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);const t=Ei(e,r.version);e.RTCPeerConnection=function(i){return i&&i.iceServers&&(i.iceServers=ki(i.iceServers,r.version),St("ICE servers after filtering:",i.iceServers)),new t(i)},e.RTCPeerConnection.prototype=t.prototype}function jr(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}var Xt=Object.freeze(Object.defineProperty({__proto__:null,shimPeerConnection:ct,shimReplaceTrack:jr,shimGetUserMedia:Or,shimGetDisplayMedia:Ar},Symbol.toStringTag,{value:"Module"}));function Lr(e,r){const t=e&&e.navigator,n=e&&e.MediaStreamTrack;if(t.getUserMedia=function(i,o,l){We("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(o,l)},!(r.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const i=function(l,a,s){a in l&&!(s in l)&&(l[s]=l[a],delete l[a])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l.audio,"autoGainControl","mozAutoGainControl"),i(l.audio,"noiseSuppression","mozNoiseSuppression")),o(l)},n&&n.prototype.getSettings){const l=n.prototype.getSettings;n.prototype.getSettings=function(){const a=l.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(n&&n.prototype.applyConstraints){const l=n.prototype.applyConstraints;n.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[a])}}}}function Ii(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||!e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,Promise.reject(i)}return n.video===!0?n.video={mediaSource:r}:n.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(n)})}function Br(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lt(e,r){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],l={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=l[i]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,l,a]=arguments;return n.apply(this,[o||null]).then(s=>{if(r.version<53&&!l)try{s.forEach(c=>{c.type=t[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;s.forEach((u,f)=>{s.set(f,Object.assign({},u,{type:t[u.type]||u.type}))})}return s}).then(l,a)}}function $r(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});const t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=t.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Ur(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),ve(e,"track",t=>(t.receiver._pc=t.srcElement,t)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Fr(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){We("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function zr(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Vr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],i=n&&"sendEncodings"in n;i&&n.sendEncodings.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=r.apply(this,arguments);if(i){const{sender:l}=o,a=l.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=n.sendEncodings,l.sendEncodings=n.sendEncodings,this.setParametersPromises.push(l.setParameters(a).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return o})}function Nr(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const n=r.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function wr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function Gr(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var Zt=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:Br,shimPeerConnection:lt,shimSenderGetStats:$r,shimReceiverGetStats:Ur,shimRemoveStream:Fr,shimRTCDataChannel:zr,shimAddTransceiver:Vr,shimGetParameters:Nr,shimCreateOffer:wr,shimCreateAnswer:Gr,shimGetUserMedia:Lr,shimGetDisplayMedia:Ii},Symbol.toStringTag,{value:"Module"}));function Hr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>r.call(this,i,n)),n.getVideoTracks().forEach(i=>r.call(this,i,n))},e.RTCPeerConnection.prototype.addTrack=function(n,...i){return i&&i.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach(o=>{i.includes(o.track)&&this.removeTrack(o)})})}}function qr(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const l=new Event("addstream");l.stream=o,n.dispatchEvent(l)})}),r.apply(n,arguments)}}}function Jr(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,t=r.createOffer,n=r.createAnswer,i=r.setLocalDescription,o=r.setRemoteDescription,l=r.addIceCandidate;r.createOffer=function(c,u){const f=arguments.length>=2?arguments[2]:arguments[0],d=t.apply(this,[f]);return u?(d.then(c,u),Promise.resolve()):d},r.createAnswer=function(c,u){const f=arguments.length>=2?arguments[2]:arguments[0],d=n.apply(this,[f]);return u?(d.then(c,u),Promise.resolve()):d};let a=function(s,c,u){const f=i.apply(this,[s]);return u?(f.then(c,u),Promise.resolve()):f};r.setLocalDescription=a,a=function(s,c,u){const f=o.apply(this,[s]);return u?(f.then(c,u),Promise.resolve()):f},r.setRemoteDescription=a,a=function(s,c,u){const f=l.apply(this,[s]);return u?(f.then(c,u),Promise.resolve()):f},r.addIceCandidate=a}function Wr(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const t=r.mediaDevices,n=t.getUserMedia.bind(t);r.mediaDevices.getUserMedia=i=>n(Qr(i))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(n,i,o){r.mediaDevices.getUserMedia(n).then(i,o)}.bind(r))}function Qr(e){return e&&e.video!==void 0?Object.assign({},e,{video:_r(e.video)}):e}function Yr(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const o=[];for(let l=0;l<n.iceServers.length;l++){let a=n.iceServers[l];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(We("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,o.push(a)):o.push(n.iceServers[l])}n.iceServers=o}return new r(n,i)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return r.generateCertificate}})}function Kr(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Xr(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio!="undefined"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio===!0&&!i&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo!="undefined"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(l=>l.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video")}return r.apply(this,arguments)}}function Zr(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var er=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:Hr,shimRemoteStreamsAPI:qr,shimCallbacksAPI:Jr,shimGetUserMedia:Wr,shimConstraints:Qr,shimRTCIceServerUrls:Yr,shimTrackEventTransceiver:Kr,shimCreateOfferLegacy:Xr,shimAudioContext:Zr},Symbol.toStringTag,{value:"Module"}));function ze(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new r(n),o=Fe.parseCandidate(n.candidate),l=Object.assign(i,o);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new r(n)},e.RTCIceCandidate.prototype=r.prototype,ve(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Pe(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const s=Fe.splitSections(a.sdp);return s.shift(),s.some(c=>{const u=Fe.parseMLine(c);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},n=function(a){const s=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(s===null||s.length<2)return-1;const c=parseInt(s[1],10);return c!==c?-1:c},i=function(a){let s=65536;return r.browser==="firefox"&&(r.version<57?a===-1?s=16384:s=2147483637:r.version<60?s=r.version===57?65535:65536:s=2147483637),s},o=function(a,s){let c=65536;r.browser==="firefox"&&r.version===57&&(c=65535);const u=Fe.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?c=parseInt(u[0].substr(19),10):r.browser==="firefox"&&s!==-1&&(c=2147483637),c},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:s}=this.getConfiguration();s==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp=="undefined"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const s=n(arguments[0]),c=i(s),u=o(arguments[0],s);let f;c===0&&u===0?f=Number.POSITIVE_INFINITY:c===0||u===0?f=Math.max(c,u):f=Math.min(c,u);const d={};Object.defineProperty(d,"maxMessageSize",{get(){return f}}),this._sctp=d}return l.apply(this,arguments)}}function ke(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function r(n,i){const o=n.send;n.send=function(){const a=arguments[0],s=a.length||a.size||a.byteLength;if(n.readyState==="open"&&i.sctp&&s>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}const t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=t.apply(this,arguments);return r(i,this),i},ve(e,"datachannel",n=>(r(n.channel,n.target),n))}function ut(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=r[t];r[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const l=new Event("connectionstatechange",i);o.dispatchEvent(l)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function ft(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=i.sdp.split(`
`).filter(l=>l.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:o}):i.sdp=o}return t.apply(this,arguments)}}function Ve(e,r){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const t=e.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}var Di=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:ze,shimMaxMessageSize:Pe,shimSendThrowTypeError:ke,shimConnectionState:ut,removeExtmapAllowMixed:ft,shimAddIceCandidateNullOrEmpty:Ve},Symbol.toStringTag,{value:"Module"}));function Mi({window:e}={},r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=St,n=Ti(e),i={browserDetails:n,commonShim:Di,extractVersion:Te,disableLog:Si,disableWarnings:_i};switch(n.browser){case"chrome":if(!Qt||!st||!r.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=Qt,Ve(e,n),Tr(e,n),Pr(e),st(e,n),kr(e),Dr(e,n),Rr(e),xr(e),Er(e),Mr(e,n),ze(e),ut(e),Pe(e,n),ke(e),ft(e,n);break;case"firefox":if(!Zt||!lt||!r.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=Zt,Ve(e,n),Lr(e,n),lt(e,n),Br(e),Fr(e),$r(e),Ur(e),zr(e),Vr(e),Nr(e),wr(e),Gr(e),ze(e),ut(e),Pe(e,n),ke(e);break;case"edge":if(!Xt||!ct||!r.shimEdge)return t("MS edge shim is not included in this adapter release."),i;t("adapter.js shimming edge."),i.browserShim=Xt,Or(e),Ar(e),ct(e,n),jr(e),Pe(e,n),ke(e);break;case"safari":if(!er||!r.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=er,Ve(e,n),Yr(e),Xr(e),Jr(e),Hr(e),qr(e),Kr(e),Wr(e),Zr(e),ze(e),Pe(e,n),ke(e),ft(e,n);break;default:t("Unsupported browser!");break}return i}const tr=Mi({window:typeof window=="undefined"?void 0:window});function ne(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}var tt=tr.default||tr,Se=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection!="undefined"},e.prototype.isBrowserSupported=function(){var r=this.getBrowser(),t=this.getVersion(),n=this.supportedBrowsers.includes(r);return n?r==="chrome"?t>=this.minChromeVersion:r==="firefox"?t>=this.minFirefoxVersion:r==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},e.prototype.getBrowser=function(){return tt.browserDetails.browser},e.prototype.getVersion=function(){return tt.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var r=this.getBrowser(),t=tt.browserDetails.version||0;if(r==="chrome"&&t<this.minChromeVersion)return!1;if(r==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,i=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),i=!0}catch{}finally{n&&n.close()}return i},e.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},e}()),rr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},Oi=function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=rr,this.browser=Se.getBrowser(),this.browserVersion=Se.getVersion(),this.supports=function(){var r={browser:Se.isBrowserSupported(),webRTC:Se.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!r.webRTC)return r;var t;try{t=new RTCPeerConnection(rr),r.audioVideo=!0;var n=void 0;try{n=t.createDataChannel("_PEERJSTEST",{ordered:!0}),r.data=!0,r.reliable=!!n.ordered;try{n.binaryType="blob",r.binaryBlob=!Se.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{t&&t.close()}return r}(),this.pack=Ht.pack,this.unpack=Ht.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(r){return!r||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(r)},e.prototype.chunk=function(r){for(var t=[],n=r.size,i=Math.ceil(n/x.chunkedMTU),o=0,l=0;l<n;){var a=Math.min(n,l+x.chunkedMTU),s=r.slice(l,a),c={__peerData:this._dataCount,n:o,data:s,total:i};t.push(c),l=a,o++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(r,t){var n=new FileReader;return n.onload=function(i){i.target&&t(i.target.result)},n.readAsArrayBuffer(r),n},e.prototype.binaryStringToArrayBuffer=function(r){for(var t=new Uint8Array(r.length),n=0;n<r.length;n++)t[n]=r.charCodeAt(n)&255;return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},e.prototype.isSecure=function(){return location.protocol==="https:"},e}(),x=new Oi,en={};ne(en,"Peer",()=>pr,e=>pr=e);var Me={},Ai=Object.prototype.hasOwnProperty,Q="~";function Ie(){}Object.create&&(Ie.prototype=Object.create(null),new Ie().__proto__||(Q=!1));function ji(e,r,t){this.fn=e,this.context=r,this.once=t||!1}function tn(e,r,t,n,i){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new ji(t,n||e,i),l=Q?Q+r:r;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function Ne(e,r){--e._eventsCount===0?e._events=new Ie:delete e._events[r]}function J(){this._events=new Ie,this._eventsCount=0}J.prototype.eventNames=function(){var r=[],t,n;if(this._eventsCount===0)return r;for(n in t=this._events)Ai.call(t,n)&&r.push(Q?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r};J.prototype.listeners=function(r){var t=Q?Q+r:r,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,l=new Array(o);i<o;i++)l[i]=n[i].fn;return l};J.prototype.listenerCount=function(r){var t=Q?Q+r:r,n=this._events[t];return n?n.fn?1:n.length:0};J.prototype.emit=function(r,t,n,i,o,l){var a=Q?Q+r:r;if(!this._events[a])return!1;var s=this._events[a],c=arguments.length,u,f;if(s.fn){switch(s.once&&this.removeListener(r,s.fn,void 0,!0),c){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,t),!0;case 3:return s.fn.call(s.context,t,n),!0;case 4:return s.fn.call(s.context,t,n,i),!0;case 5:return s.fn.call(s.context,t,n,i,o),!0;case 6:return s.fn.call(s.context,t,n,i,o,l),!0}for(f=1,u=new Array(c-1);f<c;f++)u[f-1]=arguments[f];s.fn.apply(s.context,u)}else{var d=s.length,h;for(f=0;f<d;f++)switch(s[f].once&&this.removeListener(r,s[f].fn,void 0,!0),c){case 1:s[f].fn.call(s[f].context);break;case 2:s[f].fn.call(s[f].context,t);break;case 3:s[f].fn.call(s[f].context,t,n);break;case 4:s[f].fn.call(s[f].context,t,n,i);break;default:if(!u)for(h=1,u=new Array(c-1);h<c;h++)u[h-1]=arguments[h];s[f].fn.apply(s[f].context,u)}}return!0};J.prototype.on=function(r,t,n){return tn(this,r,t,n,!1)};J.prototype.once=function(r,t,n){return tn(this,r,t,n,!0)};J.prototype.removeListener=function(r,t,n,i){var o=Q?Q+r:r;if(!this._events[o])return this;if(!t)return Ne(this,o),this;var l=this._events[o];if(l.fn)l.fn===t&&(!i||l.once)&&(!n||l.context===n)&&Ne(this,o);else{for(var a=0,s=[],c=l.length;a<c;a++)(l[a].fn!==t||i&&!l[a].once||n&&l[a].context!==n)&&s.push(l[a]);s.length?this._events[o]=s.length===1?s[0]:s:Ne(this,o)}return this};J.prototype.removeAllListeners=function(r){var t;return r?(t=Q?Q+r:r,this._events[t]&&Ne(this,t)):(this._events=new Ie,this._eventsCount=0),this};J.prototype.off=J.prototype.removeListener;J.prototype.addListener=J.prototype.on;J.prefixed=Q;J.EventEmitter=J;Me=J;var g={};ne(g,"LogLevel",()=>K,e=>K=e);ne(g,"default",()=>nr,e=>nr=e);var fe=function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,o=[],l;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){l={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return o},de=function(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,o;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))},Li="PeerJS: ",K;(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(K||(K={}));var Bi=function(){function e(){this._logLevel=K.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(r){this._logLevel=r},enumerable:!1,configurable:!0}),e.prototype.log=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this._logLevel>=K.All&&this._print.apply(this,de([K.All],fe(r),!1))},e.prototype.warn=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this._logLevel>=K.Warnings&&this._print.apply(this,de([K.Warnings],fe(r),!1))},e.prototype.error=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];this._logLevel>=K.Errors&&this._print.apply(this,de([K.Errors],fe(r),!1))},e.prototype.setLogFunction=function(r){this._print=r},e.prototype._print=function(r){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=de([Li],fe(t),!1);for(var o in i)i[o]instanceof Error&&(i[o]="("+i[o].name+") "+i[o].message);r>=K.All?console.log.apply(console,de([],fe(i),!1)):r>=K.Warnings?console.warn.apply(console,de(["WARNING"],fe(i),!1)):r>=K.Errors&&console.error.apply(console,de(["ERROR"],fe(i),!1))},e}(),nr=new Bi,rn={};ne(rn,"Socket",()=>ir,e=>ir=e);var ee;(function(e){e.Data="data",e.Media="media"})(ee||(ee={}));var L;(function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"})(L||(L={}));var ie;(function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"})(ie||(ie={}));var ae;(function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"})(ae||(ae={}));var z;(function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"})(z||(z={}));var Tt={};Tt=JSON.parse('{"name":"peerjs","version":"1.4.6","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz St\xFCckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","So\u0308ren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"type":"module","sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.cjs","browser-unminified":"dist/peerjs.cjs","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"includeNodeModules":true,"context":"browser","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"includeNodeModules":true,"context":"browser","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build && cp dist/peerjs.cjs dist/peerjs.js && cp dist/peerjs.min.cjs dist/peerjs.min.js","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var $i=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ui=function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,o=[],l;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){l={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return o},Fi=function(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,o;n<i;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))},zi=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},ir=function(e){$i(r,e);function r(t,n,i,o,l,a){a===void 0&&(a=5e3);var s=e.call(this)||this;s.pingInterval=a,s._disconnected=!0,s._messagesQueue=[];var c=t?"wss://":"ws://";return s._baseUrl=c+n+":"+i+o+"peerjs?key="+l,s}return r.prototype.start=function(t,n){var i=this;this._id=t;var o="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(n);!!this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+Tt.version),this._disconnected=!1,this._socket.onmessage=function(l){var a;try{a=JSON.parse(l.data),g.default.log("Server message received:",a)}catch{g.default.log("Invalid server message",l.data);return}i.emit(ae.Message,a)},this._socket.onclose=function(l){i._disconnected||(g.default.log("Socket closed.",l),i._cleanup(),i._disconnected=!0,i.emit(ae.Disconnected))},this._socket.onopen=function(){i._disconnected||(i._sendQueuedMessages(),g.default.log("Socket open"),i._scheduleHeartbeat())})},r.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},r.prototype._sendHeartbeat=function(){if(!this._wsOpen()){g.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:z.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},r.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},r.prototype._sendQueuedMessages=function(){var t,n,i=Fi([],Ui(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=zi(i),l=o.next();!l.done;l=o.next()){var a=l.value;this.send(a)}}catch(s){t={error:s}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},r.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(ae.Error,"Invalid message");return}if(!!this._wsOpen()){var n=JSON.stringify(t);this._socket.send(n)}}},r.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},r.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},r}(Me.EventEmitter),dt={};ne(dt,"MediaConnection",()=>sr,e=>sr=e);var Pt={};ne(Pt,"Negotiator",()=>or,e=>or=e);var we=function(){return we=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},we.apply(this,arguments)},$e=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function a(u){try{c(n.next(u))}catch(f){l(f)}}function s(u){try{c(n.throw(u))}catch(f){l(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,s)}c((n=n.apply(e,r||[])).next())})},Ue=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,l;return l={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function a(c){return function(u){return s([c,u])}}function s(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=r.call(e,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},or=function(){function e(r){this.connection=r}return e.prototype.startConnection=function(r){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===ee.Media&&r._stream&&this._addTracksToConnection(r._stream,t),r.originator){if(this.connection.type===ee.Data){var n=this.connection,i={ordered:!!r.reliable},o=t.createDataChannel(n.label,i);n.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",r.sdp)},e.prototype._startPeerConnection=function(){g.default.log("Creating RTCPeerConnection.");var r=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(r),r},e.prototype._setupListeners=function(r){var t=this,n=this.connection.peer,i=this.connection.connectionId,o=this.connection.type,l=this.connection.provider;g.default.log("Listening for ICE candidates."),r.onicecandidate=function(a){!a.candidate||!a.candidate.candidate||(g.default.log("Received ICE candidates for ".concat(n,":"),a.candidate),l.socket.send({type:z.Candidate,payload:{candidate:a.candidate,type:o,connectionId:i},dst:n}))},r.oniceconnectionstatechange=function(){switch(r.iceConnectionState){case"failed":g.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":g.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit("error",new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":g.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":r.onicecandidate=x.noop;break}t.connection.emit("iceStateChanged",r.iceConnectionState)},g.default.log("Listening for data channel"),r.ondatachannel=function(a){g.default.log("Received data channel");var s=a.channel,c=l.getConnection(n,i);c.initialize(s)},g.default.log("Listening for remote stream"),r.ontrack=function(a){g.default.log("Received remote stream");var s=a.streams[0],c=l.getConnection(n,i);if(c.type===ee.Media){var u=c;t._addStreamToMediaConnection(s,u)}}},e.prototype.cleanup=function(){g.default.log("Cleaning up PeerConnection to "+this.connection.peer);var r=this.connection.peerConnection;if(!!r){this.connection.peerConnection=null,r.onicecandidate=r.oniceconnectionstatechange=r.ondatachannel=r.ontrack=function(){};var t=r.signalingState!=="closed",n=!1;if(this.connection.type===ee.Data){var i=this.connection,o=i.dataChannel;o&&(n=!!o.readyState&&o.readyState!=="closed")}(t||n)&&r.close()}},e.prototype._makeOffer=function(){return $e(this,void 0,Promise,function(){var r,t,n,i,o,l,a;return Ue(this,function(s){switch(s.label){case 0:r=this.connection.peerConnection,t=this.connection.provider,s.label=1;case 1:return s.trys.push([1,7,,8]),[4,r.createOffer(this.connection.options.constraints)];case 2:n=s.sent(),g.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return s.sent(),g.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),i={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:x.browser},this.connection.type===ee.Data&&(o=this.connection,i=we(we({},i),{label:o.label,reliable:o.reliable,serialization:o.serialization})),t.socket.send({type:z.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return l=s.sent(),l!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(L.WebRTC,l),g.default.log("Failed to setLocalDescription, ",l)),[3,6];case 6:return[3,8];case 7:return a=s.sent(),t.emitError(L.WebRTC,a),g.default.log("Failed to createOffer, ",a),[3,8];case 8:return[2]}})})},e.prototype._makeAnswer=function(){return $e(this,void 0,Promise,function(){var r,t,n,i,o;return Ue(this,function(l){switch(l.label){case 0:r=this.connection.peerConnection,t=this.connection.provider,l.label=1;case 1:return l.trys.push([1,7,,8]),[4,r.createAnswer()];case 2:n=l.sent(),g.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),l.label=3;case 3:return l.trys.push([3,5,,6]),[4,r.setLocalDescription(n)];case 4:return l.sent(),g.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),t.socket.send({type:z.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:x.browser},dst:this.connection.peer}),[3,6];case 5:return i=l.sent(),t.emitError(L.WebRTC,i),g.default.log("Failed to setLocalDescription, ",i),[3,6];case 6:return[3,8];case 7:return o=l.sent(),t.emitError(L.WebRTC,o),g.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},e.prototype.handleSDP=function(r,t){return $e(this,void 0,Promise,function(){var n,i,o,l;return Ue(this,function(a){switch(a.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,i=this.connection.provider,g.default.log("Setting remote description",t),o=this,a.label=1;case 1:return a.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return a.sent(),g.default.log("Set remoteDescription:".concat(r," for:").concat(this.connection.peer)),r!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:return l=a.sent(),i.emitError(L.WebRTC,l),g.default.log("Failed to setRemoteDescription, ",l),[3,6];case 6:return[2]}})})},e.prototype.handleCandidate=function(r){return $e(this,void 0,Promise,function(){var t,n,i,o,l,a;return Ue(this,function(s){switch(s.label){case 0:g.default.log("handleCandidate:",r),t=r.candidate,n=r.sdpMLineIndex,i=r.sdpMid,o=this.connection.peerConnection,l=this.connection.provider,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:i,sdpMLineIndex:n,candidate:t}))];case 2:return s.sent(),g.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return a=s.sent(),l.emitError(L.WebRTC,a),g.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}})})},e.prototype._addTracksToConnection=function(r,t){if(g.default.log("add tracks from stream ".concat(r.id," to peer connection")),!t.addTrack)return g.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");r.getTracks().forEach(function(n){t.addTrack(n,r)})},e.prototype._addStreamToMediaConnection=function(r,t){g.default.log("add stream ".concat(r.id," to media connection ").concat(t.connectionId)),t.addStream(r)},e}(),kt={};ne(kt,"BaseConnection",()=>ar,e=>ar=e);var Vi=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ar=function(e){Vi(r,e);function r(t,n,i){var o=e.call(this)||this;return o.peer=t,o.provider=n,o.options=i,o._open=!1,o.metadata=i.metadata,o}return Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),r}(Me.EventEmitter),Ni=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Ge=function(){return Ge=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ge.apply(this,arguments)},wi=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},sr=function(e){Ni(r,e);function r(t,n,i){var o=e.call(this,t,n,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||r.ID_PREFIX+x.randomToken(),o._negotiator=new Pt.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(r.prototype,"type",{get:function(){return ee.Media},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),r.prototype.addStream=function(t){g.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,"stream",t)},r.prototype.handleMessage=function(t){var n=t.type,i=t.payload;switch(t.type){case z.Answer:this._negotiator.handleSDP(n,i.sdp),this._open=!0;break;case z.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:g.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},r.prototype.answer=function(t,n){var i,o;if(n===void 0&&(n={}),this._localStream){g.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(Ge(Ge({},this.options._payload),{_stream:t}));var l=this.provider._getMessages(this.connectionId);try{for(var a=wi(l),s=a.next();!s.done;s=a.next()){var c=s.value;this.handleMessage(c)}}catch(u){i={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}this._open=!0},r.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},r.ID_PREFIX="mc_",r}(kt.BaseConnection),pt={};ne(pt,"DataConnection",()=>lr,e=>lr=e);var nn={};ne(nn,"EncodingQueue",()=>cr,e=>cr=e);var Gi=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),cr=function(e){Gi(r,e);function r(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(n){t._processing=!1,n.target&&t.emit("done",n.target.result),t.doNextTask()},t.fileReader.onerror=function(n){g.default.error("EncodingQueue error:",n),t._processing=!1,t.destroy(),t.emit("error",n)},t}return Object.defineProperty(r.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),r.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},r.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},r.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},r}(Me.EventEmitter),Hi=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),qi=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},lr=function(e){Hi(r,e);function r(t,n,i){var o=e.call(this,t,n,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new nn.EncodingQueue,o.connectionId=o.options.connectionId||r.ID_PREFIX+x.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||ie.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(l){o._bufferedSend(l)}),o._encodingQueue.on("error",function(){g.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new Pt.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(r.prototype,"type",{get:function(){return ee.Data},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),r.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var t=this;(!x.supports.binaryBlob||x.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){g.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(n){g.default.log("DC#".concat(t.connectionId," dc onmessage:"),n.data),t._handleDataMessage(n)},this.dataChannel.onclose=function(){g.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},r.prototype._handleDataMessage=function(t){var n=this,i=t.data,o=i.constructor,l=this.serialization===ie.Binary||this.serialization===ie.BinaryUTF8,a=i;if(l){if(o===Blob){x.blobToArrayBuffer(i,function(c){var u=x.unpack(c);n.emit("data",u)});return}else if(o===ArrayBuffer)a=x.unpack(i);else if(o===String){var s=x.binaryStringToArrayBuffer(i);a=x.unpack(s)}}else this.serialization===ie.JSON&&(a=this.parse(i));if(a.__peerData){this._handleChunk(a);return}e.prototype.emit.call(this,"data",a)},r.prototype._handleChunk=function(t){var n=t.__peerData,i=this._chunkedData[n]||{data:[],count:0,total:t.total};if(i.data[t.n]=t.data,i.count++,this._chunkedData[n]=i,i.total===i.count){delete this._chunkedData[n];var o=new Blob(i.data);this._handleDataMessage({data:o})}},r.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,"close"))},r.prototype.send=function(t,n){if(!this.open){e.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===ie.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===ie.Binary||this.serialization===ie.BinaryUTF8){var i=x.pack(t);if(!n&&i.size>x.chunkedMTU){this._sendChunks(i);return}x.supports.binaryBlob?this._bufferedSend(i):this._encodingQueue.enque(i)}else this._bufferedSend(t)},r.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},r.prototype._trySend=function(t){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>r.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(i){return g.default.error("DC#:".concat(this.connectionId," Error when sending:"),i),this._buffering=!0,this.close(),!1}return!0},r.prototype._tryBuffer=function(){if(!!this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},r.prototype._sendChunks=function(t){var n,i,o=x.chunk(t);g.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var l=qi(o),a=l.next();!a.done;a=l.next()){var s=a.value;this.send(s,!0)}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}},r.prototype.handleMessage=function(t){var n=t.payload;switch(t.type){case z.Answer:this._negotiator.handleSDP(t.type,n.sdp);break;case z.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:g.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},r.ID_PREFIX="dc_",r.MAX_BUFFERED_AMOUNT=8388608,r}(kt.BaseConnection),on={};ne(on,"API",()=>dr,e=>dr=e);var ur=function(e,r,t,n){function i(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function a(u){try{c(n.next(u))}catch(f){l(f)}}function s(u){try{c(n.throw(u))}catch(f){l(f)}}function c(u){u.done?o(u.value):i(u.value).then(a,s)}c((n=n.apply(e,r||[])).next())})},fr=function(e,r){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,l;return l={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function a(c){return function(u){return s([c,u])}}function s(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=r.call(e,t)}catch(u){c=[6,u],i=0}finally{n=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},dr=function(){function e(r){this._options=r}return e.prototype._buildRequest=function(r){var t=this._options.secure?"https":"http",n=this._options,i=n.host,o=n.port,l=n.path,a=n.key,s=new URL("".concat(t,"://").concat(i,":").concat(o).concat(l).concat(a,"/").concat(r));return s.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),s.searchParams.set("version",Tt.version),fetch(s.href,{referrerPolicy:this._options.referrerPolicy})},e.prototype.retrieveId=function(){return ur(this,void 0,Promise,function(){var r,t,n;return fr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(r=i.sent(),r.status!==200)throw new Error("Error. Status:".concat(r.status));return[2,r.text()];case 2:throw t=i.sent(),g.default.error("Error retrieving ID",t),n="",this._options.path==="/"&&this._options.host!==x.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},e.prototype.listAllPeers=function(){return ur(this,void 0,Promise,function(){var r,t,n;return fr(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(r=i.sent(),r.status!==200)throw r.status===401?(t="",this._options.host===x.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(r.status));return[2,r.json()];case 2:throw n=i.sent(),g.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},e}(),Ji=function(){var e=function(r,t){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])},e(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e(r,t);function n(){this.constructor=r}r.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Re=function(){return Re=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Re.apply(this,arguments)},_e=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Wi=function(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,o=[],l;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(a){l={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return o},pr=function(e){Ji(r,e);function r(t,n){var i=e.call(this)||this;i._id=null,i._lastServerId=null,i._destroyed=!1,i._disconnected=!1,i._open=!1,i._connections=new Map,i._lostMessages=new Map;var o;return t&&t.constructor==Object?n=t:t&&(o=t.toString()),n=Re({debug:0,host:x.CLOUD_HOST,port:x.CLOUD_PORT,path:"/",key:r.DEFAULT_KEY,token:x.randomToken(),config:x.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),i._options=n,i._options.host==="/"&&(i._options.host=window.location.hostname),i._options.path&&(i._options.path[0]!=="/"&&(i._options.path="/"+i._options.path),i._options.path[i._options.path.length-1]!=="/"&&(i._options.path+="/")),i._options.secure===void 0&&i._options.host!==x.CLOUD_HOST?i._options.secure=x.isSecure():i._options.host==x.CLOUD_HOST&&(i._options.secure=!0),i._options.logFunction&&g.default.setLogFunction(i._options.logFunction),g.default.logLevel=i._options.debug||0,i._api=new on.API(n),i._socket=i._createServerConnection(),!x.supports.audioVideo&&!x.supports.data?(i._delayedAbort(L.BrowserIncompatible,"The current browser does not support WebRTC"),i):!!o&&!x.validateId(o)?(i._delayedAbort(L.InvalidID,'ID "'.concat(o,'" is invalid')),i):(o?i._initialize(o):i._api.retrieveId().then(function(l){return i._initialize(l)}).catch(function(l){return i._abort(L.ServerError,l)}),i)}return Object.defineProperty(r.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"connections",{get:function(){var t,n,i=Object.create(null);try{for(var o=_e(this._connections),l=o.next();!l.done;l=o.next()){var a=Wi(l.value,2),s=a[0],c=a[1];i[s]=c}}catch(u){t={error:u}}finally{try{l&&!l.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),r.prototype._createServerConnection=function(){var t=this,n=new rn.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(ae.Message,function(i){t._handleMessage(i)}),n.on(ae.Error,function(i){t._abort(L.SocketError,i)}),n.on(ae.Disconnected,function(){t.disconnected||(t.emitError(L.Network,"Lost connection to server."),t.disconnect())}),n.on(ae.Close,function(){t.disconnected||t._abort(L.SocketClosed,"Underlying socket is already closed.")}),n},r.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},r.prototype._handleMessage=function(t){var n,i,o=t.type,l=t.payload,a=t.src;switch(o){case z.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case z.Error:this._abort(L.ServerError,l.msg);break;case z.IdTaken:this._abort(L.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case z.InvalidKey:this._abort(L.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case z.Leave:g.default.log("Received leave message from ".concat(a)),this._cleanupPeer(a),this._connections.delete(a);break;case z.Expire:this.emitError(L.PeerUnavailable,"Could not connect to peer ".concat(a));break;case z.Offer:var p=l.connectionId,m=this.getConnection(a,p);if(m&&(m.close(),g.default.warn("Offer received for existing Connection ID:".concat(p))),l.type===ee.Media){var s=new dt.MediaConnection(a,this,{connectionId:p,_payload:l,metadata:l.metadata});m=s,this._addConnection(a,m),this.emit("call",s)}else if(l.type===ee.Data){var c=new pt.DataConnection(a,this,{connectionId:p,_payload:l,metadata:l.metadata,label:l.label,serialization:l.serialization,reliable:l.reliable});m=c,this._addConnection(a,m),this.emit("connection",c)}else{g.default.warn("Received malformed connection type:".concat(l.type));return}var u=this._getMessages(p);try{for(var f=_e(u),d=f.next();!d.done;d=f.next()){var h=d.value;m.handleMessage(h)}}catch(E){n={error:E}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}break;default:if(!l){g.default.warn("You received a malformed message from ".concat(a," of type ").concat(o));return}var p=l.connectionId,m=this.getConnection(a,p);m&&m.peerConnection?m.handleMessage(t):p?this._storeMessage(p,t):g.default.warn("You received an unrecognized message:",t);break}},r.prototype._storeMessage=function(t,n){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(n)},r.prototype._getMessages=function(t){var n=this._lostMessages.get(t);return n?(this._lostMessages.delete(t),n):[]},r.prototype.connect=function(t,n){if(n===void 0&&(n={}),this.disconnected){g.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(L.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var i=new pt.DataConnection(t,this,n);return this._addConnection(t,i),i},r.prototype.call=function(t,n,i){if(i===void 0&&(i={}),this.disconnected){g.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(L.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){g.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new dt.MediaConnection(t,this,Re(Re({},i),{_stream:n}));return this._addConnection(t,o),o},r.prototype._addConnection=function(t,n){g.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(n)},r.prototype._removeConnection=function(t){var n=this._connections.get(t.peer);if(n){var i=n.indexOf(t);i!==-1&&n.splice(i,1)}this._lostMessages.delete(t.connectionId)},r.prototype.getConnection=function(t,n){var i,o,l=this._connections.get(t);if(!l)return null;try{for(var a=_e(l),s=a.next();!s.done;s=a.next()){var c=s.value;if(c.connectionId===n)return c}}catch(u){i={error:u}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return null},r.prototype._delayedAbort=function(t,n){var i=this;setTimeout(function(){i._abort(t,n)},0)},r.prototype._abort=function(t,n){g.default.error("Aborting!"),this.emitError(t,n),this._lastServerId?this.disconnect():this.destroy()},r.prototype.emitError=function(t,n){g.default.error("Error:",n);var i;typeof n=="string"?i=new Error(n):i=n,i.type=t,this.emit("error",i)},r.prototype.destroy=function(){this.destroyed||(g.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},r.prototype._cleanup=function(){var t,n;try{for(var i=_e(this._connections.keys()),o=i.next();!o.done;o=i.next()){var l=o.value;this._cleanupPeer(l),this._connections.delete(l)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},r.prototype._cleanupPeer=function(t){var n,i,o=this._connections.get(t);if(!!o)try{for(var l=_e(o),a=l.next();!a.done;a=l.next()){var s=a.value;s.close()}}catch(c){n={error:c}}finally{try{a&&!a.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}},r.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;g.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},r.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)g.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)g.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},r.prototype.listAllPeers=function(t){var n=this;t===void 0&&(t=function(i){}),this._api.listAllPeers().then(function(i){return t(i)}).catch(function(i){return n._abort(L.ServerError,i)})},r.DEFAULT_KEY="peerjs",r}(Me.EventEmitter),Qi=en.Peer;const Yi={name:"ProfileDetailVideochat",components:{"error-row-card":yt,"console-log-card":gi},data(){return{myVideoPosition:{top:40,left:20},myVideoWidth:"0",myVideoHeight:"0",dragPositions:{},ringbacktone:new Audio("sounds/ringbacktone.mp3"),backtoneIsPlaying:!1,loadingIsShowing:!1,serverDateToLocalDateTimeString:Ct,VC_STATUS_FREE:Ke,myMediaStream:null,peer:null,peerCall:null,peerOptions:{constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},logArray:[]}},methods:{onCallButton(){this.vcInitComponent(),this.vcSetCallerStatus(kn),this[$t]({profileIdReceiver:this.getChatSelectedProfile.id,token:this.getUserToken})},onEndCallButton(){this.backtoneIsPlaying&&(this.ringbacktone.pause(),this.ringbacktone.currentTime=0,this.backtoneIsPlaying=!1),this.vcSetCallerStatus(Ke),this[Ut]({id:this.getVCcallEntity.id,status:Rn,token:this.getUserToken}),this.call&&this.call.open&&this.call.close()},getUserMediaMyCamera(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then(e=>{if(this.myMediaStream=e,this.$refs.videoMyStream){console.log("this.$refs.videoMyStream");const r=this.$refs.videoMyStream;r.srcObject=this.myMediaStream,r.onloadedmetadata=()=>{console.log("video.play()"),r.play()};const t=this.myMediaStream.getVideoTracks()[0].getSettings();t.width>=t.height?(this.myVideoWidth=120,this.myVideoHeight=Math.round(t.height/t.width*120)):(this.myVideoWidth=Math.round(t.height/t.width*120),this.myVideoHeight=120),console.log(`this.myVideoWidth: ${this.myVideoWidth}, this.myVideoHeight: ${this.myVideoHeight}`)}}).catch(e=>{console.log(`${e.name}: ${e.message}`),this.userPrefenceSet({key:"showMyVido",value:!1})})},getUserMediaIncomingCall(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then(e=>{this.peerCall.answer(e),this.peerCall.on("stream",r=>{const t=this.$refs.remoteStream;t.srcObject=r,t.onloadedmetadata=()=>{t.play()},console.log("this.vcSetWebRTCstatus(VC_WEBRTC_STATUS_CONNECTED)"),this.vcSetWebRTCstatus(Ft)})}).catch(e=>{console.log(`${e.name}: ${e.message}`)})},getUserMediaOutgoingCall(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then(e=>{console.log("getUserMediaOutgoingCall mediaStream"),console.log(`calling peer: ${Xe.substr(8,2)}-fc-profile-${this.getChatSelectedProfile.id}`),this.peerCall=this.peer.call(`${Xe.substr(8,2)}-fc-profile-${this.getChatSelectedProfile.id}-session-${this.getVCcallEntity.session_id_receiver}`,e,this.peerOptions),this.peerCall.on("error",r=>{this.vcSetError({errorTextArray:[r]})}),this.peerCall.on("close",()=>{console.log("on close outgoing call")}),this.peerCall.on("stream",r=>{console.log("outgoing call: this.peerCall.on stream");const t=this.$refs.remoteStream;t.srcObject=r,t.onloadedmetadata=()=>{t.play()},console.log("this.vcSetWebRTCstatus(VC_WEBRTC_STATUS_CONNECTED)"),this.vcSetWebRTCstatus(Ft)})}).catch(e=>{console.log(`${e.name}: ${e.message}`)})},onCameraToggle(){this.userPrefenceSet({key:"showMyVido",value:!this.getUserVCPreferenceShowMyVideo}),this.getUserVCPreferenceShowMyVideo?this.getUserMediaMyCamera():this.myMediaStream&&this.$refs.videoMyStream&&this.$refs.videoMyStream.srcObject&&(this.$refs.videoMyStream.srcObject=null),this[be]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onMyVideoDrag(e){e.isFirst&&(this.dragPositions.clientX=e.evt.clientX,this.dragPositions.clientY=e.evt.clientY),this.debouncedMoveMyCamera(e.evt),e.isFinal&&this.onMyVideoDragEnd()},onMyVideoDragEnd(){this.userPrefenceSet({key:`divPositionMyVideo_${window.screen.width}x${window.screen.height}`,value:this.myVideoPosition}),this[be]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onRemoteAudioToggle(){this.userPrefenceSet({key:"remoteAudioMuted",value:!this.getUserVCPreferenceRemoteAudioMuted}),this[be]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onDebugConsoleToggle(){this.userPrefenceSet({key:"showDebugConsole",value:!this.getUserVCPreferenceShowDebugConsole}),this[be]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},newPeer(){const e=`${Xe.substr(8,2)}-fc-profile-${this.getUserActiveProfileId}-session-${this.getUserSessionId}`;console.log(`newPeer: peerId: ${e}`),this.peer=new Qi(e,{config:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}]},debug:3}),this.peer.on("error",r=>{this.vcSetError({errorTextArray:[r]})}),this.peer.on("call",r=>{console.log("incoming call: this.peer.on call"),this.peerCall=r,this.peerCall.on("error",t=>{this.vcSetError({errorTextArray:[t]})}),this.peerCall.on("close",()=>{console.log("on close incoming call")}),this.getUserMediaIncomingCall()})},timeoutFunctionCheckAndHandleWebRTCtimedOut(){console.log("timeoutFunctionCheckAndHandleWebRTCtimedOut"),this.getVCcallStatusIsConnected&&this.getVCwebRTCStatus===xn&&(console.log("WebRTC: times out"),this.vcSetWebRTCstatus(En),this.onEndCallButton())},...qe(["userPrefenceSet","vcInitComponent","vcResetErrorlist","vcSetCallerStatus","vcSetError","vcSetWebRTCstatus"]),...gt([be,Ut,$t])},computed:{vcReceiverStatusDisplay(){return this.getChatVCReceiverOnlineStatus?this.getChatVCReceiverOnlineStatus:this.getVCReceiverStatusDisplay?this.getVCReceiverStatusDisplay:this.myMediaStream?"":this.$t("vcReceiverStatusDisplay_no_mediastream")},...Je(["getChatSelectedProfile","getChatVCReceiverOnlineStatus","getUserActiveProfileId","getUserPreferenceObject","getUserSessionId","getUserToken","getUserVCPostionMyVideo","getUserVCPreferenceRemoteAudioMuted","getUserVCPreferenceShowDebugConsole","getUserVCPreferenceShowMyVideo","getVCcallEntity","getVCplayRingbacktone","getVCcallerStatus","getVCerrorList","getVCcallIsOutgoing","getVCcallStatusIsConnected","getVCisFetchingReceiverProfile","getVCmodeUseReceivedProfile","getVCReceiverStatusDisplay","getVCwebRTCStatus"])},watch:{getVCplayRingbacktone(e){e?(this.ringbacktone.play(),this.backtoneIsPlaying=!0):this.ringbacktone&&(this.ringbacktone.pause(),this.ringbacktone.currentTime=0,this.backtoneIsPlaying=!1)},getVCcallStatusIsConnected(e,r){console.log(`getVCcallStatusIsConnected: ${this.getVCcallStatusIsConnected}`),e?(setTimeout(this.timeoutFunctionCheckAndHandleWebRTCtimedOut,1e4),this.getVCcallIsOutgoing&&this.getUserMediaOutgoingCall()):r&&(console.log("watch: getVCcallStatusIsConnected: change to not connected"),this.$refs.remoteStream.srcObject&&(this.$refs.remoteStream.srcObject=null),this.call&&this.call.open&&this.call.close(),this.peer&&this.peer.destroy(),this.newPeer())},getVCisFetchingReceiverProfile(e){e?this.loadingIsShowing||(this.$q.loading.show(),this.loadingIsShowing=!0):this.loadingIsShowing&&(this.$q.loading.hide(),this.loadingIsShowing=!1)}},mounted(){this.vcInitComponent(),this.getVCisFetchingReceiverProfile?(this.$q.loading.show(),this.loadingIsShowing=!0):this.getChatSelectedProfile||this.$router.push("/chat"),this.myVideoPosition=this.getUserVCPostionMyVideo,this.debouncedMoveMyCamera=mt.exports.debounce(e=>{e.touches?e.touches[0]&&(this.dragPositions.left=this.dragPositions.clientX-e.touches[0].clientX,this.dragPositions.top=this.dragPositions.clientY-e.touches[0].clientY,this.dragPositions.clientX=e.touches[0].clientX,this.dragPositions.clientY=e.touches[0].clientY):(this.dragPositions.left=this.dragPositions.clientX-e.clientX,this.dragPositions.top=this.dragPositions.clientY-e.clientY,this.dragPositions.clientX=e.clientX,this.dragPositions.clientY=e.clientY),this.$refs.myVideo.offsetTop-this.dragPositions.top>0&&(this.myVideoPosition={...this.myVideoPosition},this.myVideoPosition.top=this.$refs.myVideo.offsetTop-this.dragPositions.top,this.myVideoPosition.left=this.$refs.myVideo.offsetLeft-this.dragPositions.left)},1,{leading:!1,trailing:!0}),this.getUserVCPreferenceShowMyVideo&&this.getUserMediaMyCamera(),this.newPeer(),console.stdlog||(console.stdlog=console.log.bind(console)),console.log=(...e)=>{console.stdlog(...e),this.logArray&&this.logArray.push(e)}},beforeUnmount(){this.getVCcallerStatus!==Ke&&this.onEndCallButton(),this.peer&&this.peer.destroy()}},Ki={style:{height:"1300px"}},Xi=["src"],Zi={style:{width:"100%, height: 400","max-height":"400"}},eo=["muted"],to=["width","height"],ro={class:"bg-primary",style:{width:"100%",height:"44px"}};function no(e,r,t,n,i,o){const l=pe("error-row-card"),a=pe("console-log-card");return k(),H("div",null,[M("div",Ki,[e.getChatSelectedProfile?(k(),B(yr,{key:0,style:{"margin-top":"48px"}},{default:_(()=>[y(oe,{avatar:""},{default:_(()=>[y(gr,{rounded:""},{default:_(()=>[M("img",{src:e.getChatSelectedProfile.profile_image.filecontent},null,8,Xi)]),_:1})]),_:1}),y(oe,{style:{"max-width":"250px"}},{default:_(()=>[y(ge,null,{default:_(()=>[te(q(e.getChatSelectedProfile.name),1)]),_:1}),!e.getChatSelectedProfile.online&&e.getChatSelectedProfile.last_online?(k(),B(ge,{key:0,caption:"",class:"text-body2 q-mt-sm"},{default:_(()=>[te(q(`${e.$t("profile_onlineStatus_last_online")} ${i.serverDateToLocalDateTimeString(e.getChatSelectedProfile.last_online)}`),1)]),_:1})):j("",!0)]),_:1}),e.getChatSelectedProfile.online?(k(),B(oe,{key:0,side:"",top:""},{default:_(()=>[y(vt,{class:"q-mb-sm",color:"red"},{default:_(()=>[te(q(e.$t("profile_onlineStatus_online")),1)]),_:1})]),_:1})):j("",!0),y(oe,{side:"",top:""},{default:_(()=>[e.getVCcallerStatus===i.VC_STATUS_FREE?(k(),B(V,{key:0,push:"",round:"",dense:"",color:"green",icon:"call",disabled:e.getVCcallerStatus!==i.VC_STATUS_FREE||!e.getChatSelectedProfile.online||!e.getUserVCPreferenceShowMyVideo,size:"md",onClick:o.onCallButton},null,8,["disabled","onClick"])):j("",!0),e.getVCcallerStatus!==i.VC_STATUS_FREE?(k(),B(V,{key:1,push:"",round:"",dense:"",color:"red",icon:"call_end",size:"md",onClick:o.onEndCallButton},null,8,["onClick"])):j("",!0),y(ge,{style:{"margin-top":"5px"},class:"text-body2",caption:""},{default:_(()=>[te(q(o.vcReceiverStatusDisplay),1)]),_:1})]),_:1})]),_:1})):j("",!0),M("div",Zi,[M("video",{ref:"remoteStream",autoPlay:"true",muted:e.getUserVCPreferenceRemoteAudioMuted},null,8,eo)]),e.getUserVCPreferenceShowMyVideo?(k(),H("div",{key:1,class:"myVideo",style:In(`top: ${i.myVideoPosition.top}px;
          left: ${i.myVideoPosition.left}px;
          z-index: 9999;`),ref:"myVideo",draggable:"false"},[rt(M("video",{muted:"",width:i.myVideoWidth,height:i.myVideoHeight,display:"block",ref:"videoMyStream",autoPlay:"true",draggable:"false"},null,8,to),[[ot,o.onMyVideoDrag,void 0,{prevent:!0,mouse:!0}]])],4)):j("",!0),y(l,{errorList:e.getVCerrorList},null,8,["errorList"]),e.getUserVCPreferenceShowDebugConsole?(k(),B(a,{key:2,class:"q-ma-md",logArray:i.logArray,onOnClearDebugConsole:r[0]||(r[0]=s=>i.logArray=[]),onOnCloseDebugConsole:o.onDebugConsoleToggle},null,8,["logArray","onOnCloseDebugConsole"])):j("",!0)]),y(He,{expand:"",position:"bottom"},{default:_(()=>[M("div",ro,[y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:r[1]||(r[1]=s=>e.$router.go(-1))}),y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceShowMyVideo?"videocam":"videocam_off",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:o.onCameraToggle},null,8,["icon","onClick"]),y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceRemoteAudioMuted?"volume_off":"volume_mute",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:o.onRemoteAudioToggle},null,8,["icon","onClick"]),y(V,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceShowDebugConsole?"las la-comment":"las la-comment-slash",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:o.onDebugConsoleToggle},null,8,["icon","onClick"])])]),_:1})])}var io=De(Yi,[["render",no],["__scopeId","data-v-4f8cc665"]]);const oo={name:"ProfileDetailMain",components:{"profile-detail-info":ri,"profile-detail-chat":fi,"profile-detail-videochat":io},data(){return{tabsValue:this.getTabsValue(),settings:Dn}},methods:{getTabsValue(){let e="info";const{selectedProfileIndex:r}=this.$store.state.chat;if(r!==-1){const t=this.$store.state.chat.profiles[r];(t.is_contact||t.unread_messages_counter)&&(e="chat")}return this.$route.params.tab&&this.$route.params.tab==="videochat"&&(e="videochat"),e},...qe(["vcSetModeUseReceivedProfile"])},computed:{...Je(["getVCisFetchingReceiverProfile"])},watch:{getVCisFetchingReceiverProfile(e){e&&(this.tabsValue="videochat")}}},ao={style:{width:"100%"}};function so(e,r,t,n,i,o){const l=pe("profile-detail-info"),a=pe("profile-detail-chat"),s=pe("profile-detail-videochat");return k(),H("div",null,[i.tabsValue==="info"?(k(),B(l,{key:0})):j("",!0),i.tabsValue==="chat"?(k(),B(a,{key:1})):j("",!0),i.tabsValue==="videochat"?(k(),B(s,{key:2})):j("",!0),y(ht,null,{default:_(()=>[y(He,{expand:"",position:"top"},{default:_(()=>[M("div",ao,[y(ln,{modelValue:i.tabsValue,"onUpdate:modelValue":r[0]||(r[0]=c=>i.tabsValue=c),"no-caps":"","inline-label":"",align:"left",class:"bg-teal text-white shadow-2",breakpoint:0},{default:_(()=>[y(Ye,{name:"info",label:e.$t("chatProfileDetail_tab_Info")},null,8,["label"]),y(Ye,{name:"chat",label:e.$t("chatProfileDetail_tab_Chat")},null,8,["label"]),i.settings.featureVideoChat?(k(),B(Ye,{key:0,name:"videochat",label:e.$t("chatProfileDetail_tab_Videochat")},null,8,["label"])):j("",!0)]),_:1},8,["modelValue"])])]),_:1})]),_:1})])}var Ro=De(oo,[["render",so]]);export{Ro as default};
