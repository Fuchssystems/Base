(self["webpackChunkbase"]=self["webpackChunkbase"]||[]).push([[82],{6610:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>Qe});var i=o(3673);const s={style:{width:"100%"}};function l(e,t,o,l,a,r){const n=(0,i.up)("profile-detail-info"),d=(0,i.up)("profile-detail-chat"),c=(0,i.up)("profile-detail-videochat"),h=(0,i.up)("q-tab"),g=(0,i.up)("q-tabs"),m=(0,i.up)("q-page-sticky"),u=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)("div",null,["info"===a.tabsValue?((0,i.wg)(),(0,i.j4)(n,{key:0})):(0,i.ry)("",!0),"chat"===a.tabsValue?((0,i.wg)(),(0,i.j4)(d,{key:1})):(0,i.ry)("",!0),"videochat"===a.tabsValue?((0,i.wg)(),(0,i.j4)(c,{key:2})):(0,i.ry)("",!0),(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(m,{expand:"",position:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)("div",s,[(0,i.Wm)(g,{modelValue:a.tabsValue,"onUpdate:modelValue":t[1]||(t[1]=e=>a.tabsValue=e),"no-caps":"","inline-label":"",align:"left",class:"bg-teal text-white shadow-2",breakpoint:0},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{name:"info",label:e.$t("chatProfileDetail_tab_Info")},null,8,["label"]),(0,i.Wm)(h,{name:"chat",label:e.$t("chatProfileDetail_tab_Chat")},null,8,["label"]),a.settings.featureVideoChat?((0,i.wg)(),(0,i.j4)(h,{key:0,name:"videochat",label:e.$t("chatProfileDetail_tab_Videochat")},null,8,["label"])):(0,i.ry)("",!0)])),_:1},8,["modelValue"])])])),_:1})])),_:1})])}var a=o(515),r=o.n(a),n=o(7874),d=o(2323);const c={style:{"margin-top":"30px","margin-right":"6px","margin-left":"-19px",width:"100%","max-width":"600px"}},h={class:"row q-pa-sm",style:{width:"100%","max-width":"600px"}},g={class:"col-3",style:{width:"160px"}},m={class:"col",style:{"margin-left":"12px"}},u={class:"text-h6"},p={class:"text-body2",style:{"margin-top":"-4px","margin-left":"-6px"}},f={key:0,style:{"margin-top":"-2px"}},C={key:1,style:{"margin-top":"-2px"},class:"text-body2"},y={key:2,style:{"margin-top":"-2px",height:"21px"}},S={class:"text-body2 q-mt-sm",style:{"margin-top":"5px"}},P={class:"text-bod2"},b={class:"row",style:{width:"100%","max-width":"600px"}},v={class:"col",style:{"margin-top":"6px","margin-left":"152px"}},w={class:"q-pr-sm",style:{"margin-left":"5px",width:"100%","max-width":"600px"}},I={key:0,class:"div-carousel"},x={key:1,class:"text-h6 q-mx-md text-blue-grey-8"},_={class:"bg-primary",style:{width:"100%",height:"34px"}};function k(e,t,o,s,l,a){const r=(0,i.up)("q-img"),n=(0,i.up)("q-icon"),k=(0,i.up)("q-toggle"),V=(0,i.up)("q-badge"),T=(0,i.up)("q-carousel-slide"),W=(0,i.up)("q-carousel"),M=(0,i.up)("q-btn"),U=(0,i.up)("q-slider"),$=(0,i.up)("q-carousel-control"),R=(0,i.up)("q-skeleton"),D=(0,i.up)("error-row-card"),q=(0,i.up)("q-page-sticky"),A=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(A,null,{default:(0,i.w5)((()=>[(0,i.Wm)("div",c,[(0,i.Wm)(W,{swipeable:"",animated:"",ref:"carouselProfiles","model-value":e.getChatSelectedProfileId,"onUpdate:modelValue":a.onProfileInput,height:"197px"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(e.getChatProfiles,(t=>((0,i.wg)(),(0,i.j4)(T,{key:t.id,name:t.id},{default:(0,i.w5)((()=>[(0,i.Wm)("div",h,[(0,i.Wm)("div",g,[(0,i.Wm)(r,{class:"rounded-borders",src:t.profile_image.filecontent},null,8,["src"])]),(0,i.Wm)("div",m,[(0,i.Wm)("div",u,(0,d.zw)(t.name),1),(0,i.Wm)("div",p,[(0,i.Wm)(n,{name:l.attributeOptions[t.gender_male_female_diverse_null].icon,color:l.attributeOptions[t.gender_male_female_diverse_null].color,size:"sm"},null,8,["name","color"]),(0,i.Uk)(" "+(0,d.zw)(`${t.ageYears} ${e.$t("app_word_years")}`)+" ",1),(0,i.Wm)(k,{"model-value":!!t.is_contact,"onUpdate:modelValue":e=>a.onToggleIsContact(t),icon:l.attributeOptions.is_contact.icon,color:l.attributeOptions.is_contact.color},null,8,["model-value","onUpdate:modelValue","icon","color"])]),t.online?((0,i.wg)(),(0,i.j4)("div",f,[(0,i.Wm)(V,{color:"red"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,d.zw)(e.$t("profile_onlineStatus_online")),1)])),_:1})])):(0,i.ry)("",!0),!t.online&&t.last_online?((0,i.wg)(),(0,i.j4)("div",C,(0,d.zw)(`${e.$t("profile_onlineStatus_last_online")} ${l.serverDateToLocalDateTimeString(t.last_online)}`),1)):(0,i.ry)("",!0),t.online||t.last_online?(0,i.ry)("",!0):((0,i.wg)(),(0,i.j4)("div",y)),(0,i.Wm)("div",S,(0,d.zw)(`${t.country_code_iso_3166_alpha_2}-${t.areacode} ${t.city}`),1),(0,i.Wm)("div",P,(0,d.zw)(`${e.$t("app_word_distance")}: ${t.distance} km`),1)])])])),_:2},1032,["name"])))),128))])),_:1},8,["model-value","onUpdate:modelValue"]),(0,i.Wm)("div",b,[(0,i.Wm)("div",v,[(0,i.Wm)(M,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",style:{"margin-right":"10px"},onClick:t[1]||(t[1]=t=>e.$router.go(-1))}),(0,i.Wm)(M,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_left",style:{"margin-right":"5px"},disabled:0===e.getChatSelectedProfileIndex,onClick:t[2]||(t[2]=e=>a.onButtonGotoPanel("previous"))},null,8,["disabled"]),(0,i.Wm)(M,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_right",disabled:e.getChatSelectedProfileIndex>=e.getChatProfiles.length-1,onClick:t[3]||(t[3]=e=>a.onButtonGotoPanel("next"))},null,8,["disabled"]),(0,i.Wm)(U,{min:1,max:e.getChatProfiles.length,color:"primary","model-value":e.getChatSelectedProfileIndex+1,"onUpdate:modelValue":a.onSliderProfileIndex,class:"vertical-top",style:{width:"60px",display:"inline-block",margin:"6px -30px -6px 20px","padding-right":"0px"},step:1,label:"","label-value":`${e.getChatSelectedProfileIndex+1}/${e.getChatProfiles.length}`,"label-always":""},null,8,["max","model-value","onUpdate:modelValue","label-value"])])])]),(0,i.Wm)("div",w,[e.getChatProfileImages.length?((0,i.wg)(),(0,i.j4)("div",I,[(0,i.Wm)(W,{swipeable:"",animated:"",arrows:e.getChatProfileImages.length>1,thumbnails:e.getChatProfileImages.length>1,"model-value":e.getChatProfileImagesSelectedId,fullscreen:l.carouselProfileImagesFullscreen,"onUpdate:fullscreen":t[5]||(t[5]=e=>l.carouselProfileImagesFullscreen=e),infinite:"","onUpdate:modelValue":e.chatSetSelectedProfileImageId,height:"480px"},{control:(0,i.w5)((()=>[(0,i.Wm)($,{position:"bottom-right",offset:[18,18]},{default:(0,i.w5)((()=>[(0,i.Wm)(M,{push:"",round:"",dense:"",color:"white","text-color":"primary",icon:l.carouselProfileImagesFullscreen?"fullscreen_exit":"fullscreen",onClick:t[4]||(t[4]=e=>l.carouselProfileImagesFullscreen=!l.carouselProfileImagesFullscreen)},null,8,["icon"])])),_:1})])),default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(e.getChatProfileImages,(e=>((0,i.wg)(),(0,i.j4)(T,{image:e,key:e.id,name:e.id,"img-src":e.filecontent},null,8,["image","name","img-src"])))),128))])),_:1},8,["arrows","thumbnails","model-value","fullscreen","onUpdate:modelValue"])])):(0,i.ry)("",!0)]),e.getChatProfileImagesIsFetching?((0,i.wg)(),(0,i.j4)(R,{key:0,height:"120px",class:"q-ma-sm",style:{width:"100%","max-width":"600px"}})):(0,i.ry)("",!0),e.getChatProfileImagesShowNoImagesFound?((0,i.wg)(),(0,i.j4)("div",x,(0,d.zw)(l.m("app_search_message_no_recordnames",{recordname:"picture"})),1)):(0,i.ry)("",!0),(0,i.Wm)(D,{errorList:e.getChatProfileImagesErrorList},null,8,["errorList"]),(0,i.Wm)(q,{expand:"",position:"bottom"},{default:(0,i.w5)((()=>[(0,i.Wm)("div",_,[(0,i.Wm)(M,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"sm",style:{margin:"5px 0px 5px 16px"},onClick:t[6]||(t[6]=t=>e.$router.go(-1))})])])),_:1})])),_:1})}var V=o(8603),T=o(7476),W=o(816),M=o(9051),U=o(7636),$=o(6401),R=o(4532);const D=function(e){const t=new Date(`${e} UTC`);let o=t.toLocaleDateString(R.i18nGlobal.t("app_locale_browser"),{day:"2-digit",month:"2-digit",year:"2-digit"});return o+=" ",o+=t.toLocaleTimeString(R.i18nGlobal.t("app_locale_browser"),{hourCycle:"h23",hour:"2-digit",minute:"2-digit"}),o},q={name:"ProfileDetailInfo",components:{"error-row-card":W.Z},data(){return{profileIdsToRemoveFromSelection:[],carouselProfileImagesFullscreen:!1,attributeOptions:U.V,m:$.m,serverDateToLocalDateTimeString:D}},methods:r()(r()({fetchSelectedProfileIdImages:(0,V.throttle)((function(){this.chatClearProfileImagesFetchResult(),this.getChatProfileImagesErrorList.length&&this.chatProfileImagesResetErrorlist(),this[M.hW]({profileId:this.getChatSelectedProfileId,token:this.getUserToken})}),100),onProfileInput(e){this.chatSetSelectedProfileId(e),this.fetchSelectedProfileIdImages()},onButtonGotoPanel(e){const t="next"===e?this.getChatSelectedProfileIndex+1:this.getChatSelectedProfileIndex-1;this.chatSetSelectedProfileId(this.getChatProfiles[t].id),this.fetchSelectedProfileIdImages()},onSliderProfileIndex(e){this.chatSetSelectedProfileId(this.getChatProfiles[e-1].id),this.fetchSelectedProfileIdImages()},onToggleIsContact(e){if(this[M.om]({thisProfileId:this.getUserActiveProfileId,profile:r()(r()({},e),{},{is_contact:!e.is_contact}),token:this.getUserToken}),!this.getUserPreferenceChatSearchModeIsProfiles)if(e.is_contact)this.profileIdsToRemoveFromSelection.push(e.id);else{const t=this.profileIdsToRemoveFromSelection.findIndex((t=>t===e.id));-1!==t&&this.profileIdsToRemoveFromSelection.splice(t,1)}}},(0,n.nv)(["chatRemoveProfilesFromSelection","chatSetSelectedProfileId","chatSetSelectedProfileImageId","chatClearProfileImagesFetchResult","chatProfileImagesResetErrorlist"])),(0,T.$R)([M.hW,M.Cp,M.om])),computed:r()({},(0,n.Se)(["getChatProfiles","getChatSelectedProfileId","getChatSelectedProfileIndex","getChatProfileImages","getChatProfileImagesIsFetching","getChatProfileImagesProfileIdSet","getChatProfileImagesSelectedId","getChatProfileImagesErrorList","getChatProfileImagesShowNoImagesFound","getUserActiveProfileId","getUserToken","getUserPreferenceChatSearchModeIsProfiles"])),mounted(){this.getChatSelectedProfileId!==this.getChatProfileImagesProfileIdSet&&this.fetchSelectedProfileIdImages()},beforeUnmount(){console.log("before destroy: this.profileIdsToRemoveFromSelection"),console.log(this.profileIdsToRemoveFromSelection),this.chatRemoveProfilesFromSelection(this.profileIdsToRemoveFromSelection),this[M.Cp]()}};var A=o(4379),j=o(1277),Z=o(4593),Q=o(4027),E=o(4554),F=o(8886),O=o(9721),L=o(8240),z=o(2064),B=o(7607),Y=o(4103),H=o(1007),X=o(7518),K=o.n(X);q.render=k;const G=q;K()(q,"components",{QPage:A.Z,QCarousel:j.Z,QCarouselSlide:Z.Z,QImg:Q.Z,QIcon:E.Z,QToggle:F.Z,QBadge:O.Z,QBtn:L.Z,QSlider:z.Z,QCarouselControl:B.Z,QSkeleton:Y.ZP,QPageSticky:H.Z});var N=o(8880);const J=(0,i.HX)("data-v-7deff6cc");(0,i.dD)("data-v-7deff6cc");const ee={class:"row"},te={class:"row"},oe={class:"row"},ie={class:"bg-primary",style:{width:"100%",height:"44px"}};(0,i.Cn)();const se=J(((e,t,o,s,l,a)=>{const r=(0,i.up)("q-btn"),n=(0,i.up)("q-item-section"),c=(0,i.up)("q-avatar"),h=(0,i.up)("q-item-label"),g=(0,i.up)("q-badge"),m=(0,i.up)("q-item"),u=(0,i.up)("q-carousel-slide"),p=(0,i.up)("q-carousel"),f=(0,i.up)("q-chat-message"),C=(0,i.up)("q-scroll-area"),y=(0,i.up)("q-skeleton"),S=(0,i.up)("error-row-card"),P=(0,i.up)("q-input"),b=(0,i.up)("q-page-sticky"),v=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(v,{class:"q-pa-sm",style:{"margin-top":"50px"}},{default:J((()=>[(0,i.Wm)("div",ee,[(0,i.Wm)(p,{class:"col",style:{margin:"-20px -30px",width:"100%","max-width":"400px"},swipeable:"",animated:"",ref:"carouselProfiles","model-value":e.getChatSelectedProfileId,"onUpdate:modelValue":a.onProfileInput,height:"100px"},{default:J((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(e.getChatProfiles,(o=>((0,i.wg)(),(0,i.j4)(u,{key:o.id,name:o.id},{default:J((()=>[(0,i.Wm)(m,null,{default:J((()=>[(0,i.Wm)(n,{side:"",left:""},{default:J((()=>[(0,i.Wm)(r,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_left",disabled:0===e.getChatSelectedProfileIndex,onClick:t[1]||(t[1]=e=>a.onButtonGotoPanel("previous"))},null,8,["disabled"])])),_:1}),(0,i.Wm)(n,{avatar:""},{default:J((()=>[(0,i.Wm)(c,{rounded:""},{default:J((()=>[(0,i.Wm)("img",{src:o.profile_image.filecontent},null,8,["src"])])),_:2},1024)])),_:2},1024),(0,i.Wm)(n,null,{default:J((()=>[(0,i.Wm)(h,null,{default:J((()=>[(0,i.Uk)((0,d.zw)(o.name),1)])),_:2},1024),!o.online&&o.last_online?((0,i.wg)(),(0,i.j4)(h,{key:0,caption:"",class:"text-body2 q-mt-sm"},{default:J((()=>[(0,i.Uk)((0,d.zw)(`${l.$t("profile_onlineStatus_last_online")} ${l.serverDateToLocalDateTimeString(o.last_online)}`),1)])),_:2},1024)):(0,i.ry)("",!0)])),_:2},1024),o.online?((0,i.wg)(),(0,i.j4)(n,{key:0,side:"",top:""},{default:J((()=>[(0,i.Wm)(g,{class:"q-mb-sm",color:"red"},{default:J((()=>[(0,i.Uk)((0,d.zw)(l.$t("profile_onlineStatus_online")),1)])),_:1}),(0,i.Wm)(N.uT,{name:"fade"},{default:J((()=>[e.getChatProfileSetIsWriting?((0,i.wg)(),(0,i.j4)(h,{key:0,class:"text-body2 text-green"},{default:J((()=>[(0,i.Uk)((0,d.zw)(l.$t("chat_message_isWriting")),1)])),_:1})):(0,i.ry)("",!0)])),_:1})])),_:1})):(0,i.ry)("",!0),(0,i.Wm)(n,{side:"",right:""},{default:J((()=>[(0,i.Wm)(r,{push:"",round:"",dense:"",color:"primary","text-color":"black",icon:"arrow_right",disabled:e.getChatSelectedProfileIndex>=e.getChatProfiles.length-1,onClick:t[2]||(t[2]=e=>a.onButtonGotoPanel("next"))},null,8,["disabled"])])),_:1})])),_:2},1024)])),_:2},1032,["name"])))),128))])),_:1},8,["model-value","onUpdate:modelValue"])]),(0,i.Wm)("div",te,[e.getChatChatMessagesIsFetching?(0,i.ry)("",!0):((0,i.wg)(),(0,i.j4)(C,{key:0,class:"col q-mb-md q-pa-sm col bg-light-blue-1",style:{height:"calc(100vh - 372px)",width:"100%","max-width":"340px"},"thumb-style":l.thumbStyle,"bar-style":l.barStyle,ref:"messages"},{default:J((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(e.getChatChatMessages,(t=>((0,i.wg)(),(0,i.j4)("div",{class:"q-pa-xs",key:t.id},[(0,i.Wm)(f,{text:[t.messageText],stamp:t.send_at?l.serverDateToLocalDateTimeString(t.send_at):"",sent:t.profile_id_sender==e.getUserActiveProfileId,"bg-color":t.profile_id_sender===e.getUserActiveProfileId?"amber-2":"light-green-2"},null,8,["text","stamp","sent","bg-color"])])))),128))])),_:1},8,["thumb-style","bar-style"])),e.getChatChatMessagesIsFetching?((0,i.wg)(),(0,i.j4)(y,{key:1,height:"calc(100vh - 372px)",class:"q-mb-md q-pa-sm",style:{width:"100%","max-width":"340px"}})):(0,i.ry)("",!0)]),(0,i.Wm)(S,{errorList:e.getChatChatMessagesErrorList},null,8,["errorList"]),(0,i.Wm)("div",oe,[(0,i.Wm)(P,{modelValue:l.messageToSend,"onUpdate:modelValue":t[3]||(t[3]=e=>l.messageToSend=e),class:"col",style:{width:"100%","max-width":"340px"},type:"textarea",filled:"",placeholder:l.$t("chat_field_messageToSend_placeholder"),onKeydown:a.onKeyDownMessageToSend},{append:J((()=>[(0,i.Wm)(r,{round:"",dense:"",flat:"",icon:"send",disabled:!l.messageToSend,onClick:a.onChatMessageSend},null,8,["disabled","onClick"])])),_:1},8,["modelValue","placeholder","onKeydown"])]),(0,i.Wm)(b,{expand:"",position:"bottom"},{default:J((()=>[(0,i.Wm)("div",ie,[(0,i.Wm)(r,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:t[4]||(t[4]=t=>e.$router.go(-1))})])])),_:1})])),_:1})}));var le=o(5948);const ae={name:"ProfileDetailChat",components:{"error-row-card":W.Z},data(){return{messageToSend:"",thumbStyle:{right:"4px",borderRadius:"5px",backgroundColor:"#027be3",width:"5px",opacity:.75},barStyle:{right:"2px",borderRadius:"9px",backgroundColor:"#027be3",width:"9px",opacity:.2},attributeOptions:U.V,serverDateToLocalDateTimeString:D,$t:(0,le.QT)().t}},methods:r()(r()({fetchSelectedProfileIdChatMessages(){this.chatClearChatMessagesFetchResult(),this.getChatChatMessagesErrorList.length&&this.chatchatMessagesResetErrorlist(),this[M.sL]({profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,token:this.getUserToken})},onProfileInput(e){this.chatSetSelectedProfileId(e),this.fetchSelectedProfileIdChatMessages()},onButtonGotoPanel(e){const t="next"===e?this.getChatSelectedProfileIndex+1:this.getChatSelectedProfileIndex-1;this.chatSetSelectedProfileId(this.getChatProfiles[t].id),this.fetchSelectedProfileIdChatMessages()},onChatMessageSend(){const e=(new Date).getTime();this.chatChatMessageSend({type:"chatChatMessageSend",profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,messageText:this.messageToSend,temporaryMessageId:e}),this.getChatChatMessagesErrorList.length&&this.chatchatMessagesResetErrorlist(),this[M.AJ]({message:{profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId,messageText:this.messageToSend},temporaryMessageId:e,token:this.getUserToken}),this.messageToSend=""},onKeyDownMessageToSend(){this.getChatSelectedProfile&&this.getChatSelectedProfile.online&&this.debouncedSendIsWriting()}},(0,n.nv)(["chatSetSelectedProfileId","chatClearChatMessagesFetchResult","chatchatMessagesResetErrorlist","chatChatMessageSend","chatSetScrollMessagesDown"])),(0,T.$R)([M.AJ,M.sL,M.TY,M.z4])),computed:r()({},(0,n.Se)(["getChatChatMessagesErrorList","getChatChatMessages","getChatChatMessagesIsFetching","getChatChatMessagesProfileIdSet","getChatSelectedProfile","getChatSetScrollMessagesDown","getChatProfiles","getChatSelectedProfileId","getChatSelectedProfileIndex","getChatProfileSetIsWriting","getUserActiveProfileId","getUserToken"])),updated(){this.getChatSetScrollMessagesDown&&setTimeout((()=>{this.$refs.messages&&(this.$refs.messages.setScrollPercentage("vertical",1),this.chatSetScrollMessagesDown({scrollDownValue:!1}))}),500)},mounted(){this.getChatSelectedProfileId!==this.getChatChatMessagesProfileIdSet&&this.fetchSelectedProfileIdChatMessages(),this.debouncedSendIsWriting=(0,V.debounce)((()=>{this[M.z4]({type:"isWriting",profileIdSender:this.getUserActiveProfileId,profileIdReceiver:this.getChatSelectedProfileId})}),3e3,{leading:!0,trailing:!1})},beforeUnmount(){this[M.TY](),this.chatClearChatMessagesFetchResult()}};var re=o(3414),ne=o(2035),de=o(5096),ce=o(2350),he=o(7704),ge=o(629),me=o(4842);ae.render=se,ae.__scopeId="data-v-7deff6cc";const ue=ae;K()(ae,"components",{QPage:A.Z,QCarousel:j.Z,QCarouselSlide:Z.Z,QItem:re.Z,QItemSection:ne.Z,QBtn:L.Z,QAvatar:de.Z,QItemLabel:ce.Z,QBadge:O.Z,QScrollArea:he.Z,QChatMessage:ge.Z,QSkeleton:Y.ZP,QInput:me.Z,QPageSticky:H.Z});const pe=(0,i.HX)("data-v-103dd038");(0,i.dD)("data-v-103dd038");const fe={style:{height:"1300px"}},Ce={style:{width:"100%, height: 400","max-height":"400"}},ye={class:"bg-primary",style:{width:"100%",height:"44px"}};(0,i.Cn)();const Se=pe(((e,t,o,s,l,a)=>{const r=(0,i.up)("q-avatar"),n=(0,i.up)("q-item-section"),c=(0,i.up)("q-item-label"),h=(0,i.up)("q-badge"),g=(0,i.up)("q-btn"),m=(0,i.up)("q-item"),u=(0,i.up)("error-row-card"),p=(0,i.up)("console-log-card"),f=(0,i.up)("q-page-sticky"),C=(0,i.Q2)("touch-pan");return(0,i.wg)(),(0,i.j4)("div",null,[(0,i.Wm)("div",fe,[e.getChatSelectedProfile?((0,i.wg)(),(0,i.j4)(m,{key:0,style:{"margin-top":"48px"}},{default:pe((()=>[(0,i.Wm)(n,{avatar:""},{default:pe((()=>[(0,i.Wm)(r,{rounded:""},{default:pe((()=>[(0,i.Wm)("img",{src:e.getChatSelectedProfile.profile_image.filecontent},null,8,["src"])])),_:1})])),_:1}),(0,i.Wm)(n,{style:{"max-width":"250px"}},{default:pe((()=>[(0,i.Wm)(c,null,{default:pe((()=>[(0,i.Uk)((0,d.zw)(e.getChatSelectedProfile.name),1)])),_:1}),!e.getChatSelectedProfile.online&&e.getChatSelectedProfile.last_online?((0,i.wg)(),(0,i.j4)(c,{key:0,caption:"",class:"text-body2 q-mt-sm"},{default:pe((()=>[(0,i.Uk)((0,d.zw)(`${e.$t("profile_onlineStatus_last_online")} ${l.serverDateToLocalDateTimeString(e.getChatSelectedProfile.last_online)}`),1)])),_:1})):(0,i.ry)("",!0)])),_:1}),e.getChatSelectedProfile.online?((0,i.wg)(),(0,i.j4)(n,{key:0,side:"",top:""},{default:pe((()=>[(0,i.Wm)(h,{class:"q-mb-sm",color:"red"},{default:pe((()=>[(0,i.Uk)((0,d.zw)(e.$t("profile_onlineStatus_online")),1)])),_:1})])),_:1})):(0,i.ry)("",!0),(0,i.Wm)(n,{side:"",top:""},{default:pe((()=>[e.getVCcallerStatus===l.VC_STATUS_FREE?((0,i.wg)(),(0,i.j4)(g,{key:0,push:"",round:"",dense:"",color:"green",icon:"call",disabled:e.getVCcallerStatus!==l.VC_STATUS_FREE||!e.getChatSelectedProfile.online||!e.getUserVCPreferenceShowMyVideo,size:"md",onClick:a.onCallButton},null,8,["disabled","onClick"])):(0,i.ry)("",!0),e.getVCcallerStatus!==l.VC_STATUS_FREE?((0,i.wg)(),(0,i.j4)(g,{key:1,push:"",round:"",dense:"",color:"red",icon:"call_end",size:"md",onClick:a.onEndCallButton},null,8,["onClick"])):(0,i.ry)("",!0),(0,i.Wm)(c,{style:{"margin-top":"5px"},class:"text-body2",caption:""},{default:pe((()=>[(0,i.Uk)((0,d.zw)(a.vcReceiverStatusDisplay),1)])),_:1})])),_:1})])),_:1})):(0,i.ry)("",!0),(0,i.Wm)("div",Ce,[(0,i.Wm)("video",{ref:"remoteStream",autoPlay:"true",muted:e.getUserVCPreferenceRemoteAudioMuted},null,8,["muted"])]),e.getUserVCPreferenceShowMyVideo?((0,i.wg)(),(0,i.j4)("div",{key:1,class:"myVideo",style:`top: ${l.myVideoPosition.top}px;\n          left: ${l.myVideoPosition.left}px;\n          z-index: 100;`,ref:"myVideo",draggable:"false"},[(0,i.wy)((0,i.Wm)("video",{muted:"",width:l.myVideoWidth,height:l.myVideoHeight,display:"block",ref:"videoMyStream",autoPlay:"true",draggable:"false"},null,8,["width","height"]),[[C,a.onMyVideoDrag,void 0,{prevent:!0,mouse:!0}]])],4)):(0,i.ry)("",!0),(0,i.Wm)(u,{errorList:e.getVCerrorList},null,8,["errorList"]),e.getUserVCPreferenceShowDebugConsole?((0,i.wg)(),(0,i.j4)(p,{key:2,class:"q-ma-md",logArray:l.logArray,onOnClearDebugConsole:t[1]||(t[1]=e=>l.logArray=[]),onOnCloseDebugConsole:a.onDebugConsoleToggle},null,8,["logArray","onOnCloseDebugConsole"])):(0,i.ry)("",!0)]),(0,i.Wm)(f,{expand:"",position:"bottom"},{default:pe((()=>[(0,i.Wm)("div",ye,[(0,i.Wm)(g,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:"navigate_before",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:t[2]||(t[2]=t=>e.$router.go(-1))}),(0,i.Wm)(g,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceShowMyVideo?"videocam":"videocam_off",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:a.onCameraToggle},null,8,["icon","onClick"]),(0,i.Wm)(g,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceRemoteAudioMuted?"volume_off":"volume_mute",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:a.onRemoteAudioToggle},null,8,["icon","onClick"]),(0,i.Wm)(g,{push:"",round:"",dense:"",color:"black","text-color":"white",icon:e.getUserVCPreferenceShowDebugConsole?"las la-comment":"las la-comment-slash",size:"md",style:{margin:"5px 0px 5px 16px"},onClick:a.onDebugConsoleToggle},null,8,["icon","onClick"])])])),_:1})])}));o(71);const Pe={class:"row"},be=(0,i.Uk)("Log");function ve(e,t,o,s,l,a){const r=(0,i.up)("q-toolbar-title"),n=(0,i.up)("q-btn"),c=(0,i.up)("q-toolbar"),h=(0,i.up)("q-scroll-area"),g=(0,i.up)("q-card");return(0,i.wg)(),(0,i.j4)("div",Pe,[(0,i.Wm)(g,{flat:"",bordered:"",class:"consolelog-card q-mt-md bg-info"},{default:(0,i.w5)((()=>[(0,i.Wm)(c,{class:"bg-blue-2"},{default:(0,i.w5)((()=>[(0,i.Wm)(r,null,{default:(0,i.w5)((()=>[be])),_:1}),(0,i.Wm)(n,{push:"",round:"",color:"blue-grey-8","text-color":"white",disabled:!o.logArray.length,icon:"clear_all",size:"sm",onClick:t[1]||(t[1]=t=>e.$emit("onClearDebugConsole"))},null,8,["disabled"]),(0,i.Wm)(n,{push:"",round:"",color:"blue-grey-8","text-color":"white",style:{"margin-left":"10px"},icon:"close",size:"sm",onClick:t[2]||(t[2]=t=>e.$emit("onCloseDebugConsole"))})])),_:1}),(0,i.Wm)(h,{ref:"scrollArea",style:{height:"200px",width:"100%"}},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(o.logArray,((e,t)=>((0,i.wg)(),(0,i.j4)("div",{key:t,class:"q-my-xs text-caption consolelog-item"},(0,d.zw)(e),1)))),128))])),_:1},512)])),_:1})])}const we={name:"ConsoleLogCard",props:{logArray:Array},emits:["onClearDebugConsole","onCloseDebugConsole"],watch:{logArray(){this.$refs.scrollArea.setScrollPercentage("vertical",1)}}};var Ie=o(151),xe=o(9570),_e=o(3747);we.render=ve;const ke=we;K()(we,"components",{QCard:Ie.Z,QToolbar:xe.Z,QToolbarTitle:_e.Z,QBtn:L.Z,QScrollArea:he.Z});var Ve=o(6264),Te=o.n(Ve),We=o(6630),Me=o(7942),Ue=o(9984);const $e={name:"ProfileDetailVideochat",components:{"error-row-card":W.Z,"console-log-card":ke},data(){return{myVideoPosition:{top:40,left:20},myVideoWidth:"0",myVideoHeight:"0",dragPositions:{},ringbacktone:new Audio("sounds/ringbacktone.mp3"),backtoneIsPlaying:!1,loadingIsShowing:!1,serverDateToLocalDateTimeString:D,VC_STATUS_FREE:Me.lm,myMediaStream:null,peer:null,peerCall:null,peerOptions:{constraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}},logArray:[]}},methods:r()(r()({onCallButton(){this.vcInitComponent(),this.vcSetCallerStatus(Me.f2),this[Me.eI]({profileIdReceiver:this.getChatSelectedProfile.id,token:this.getUserToken})},onEndCallButton(){this.backtoneIsPlaying&&(this.ringbacktone.pause(),this.ringbacktone.currentTime=0,this.backtoneIsPlaying=!1),this.vcSetCallerStatus(Me.lm),this[Me.$M]({id:this.getVCcallEntity.id,status:Me.HC,token:this.getUserToken}),this.call&&this.call.open&&this.call.close()},getUserMediaMyCamera(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then((e=>{if(this.myMediaStream=e,this.$refs.videoMyStream){console.log("this.$refs.videoMyStream");const e=this.$refs.videoMyStream;e.srcObject=this.myMediaStream,e.onloadedmetadata=()=>{console.log("video.play()"),e.play()};const t=this.myMediaStream.getVideoTracks()[0].getSettings();t.width>=t.height?(this.myVideoWidth=120,this.myVideoHeight=Math.round(t.height/t.width*120)):(this.myVideoWidth=Math.round(t.height/t.width*120),this.myVideoHeight=120),console.log(`this.myVideoWidth: ${this.myVideoWidth}, this.myVideoHeight: ${this.myVideoHeight}`)}})).catch((e=>{console.log(`${e.name}: ${e.message}`),this.userPrefenceSet({key:"showMyVido",value:!1})}))},getUserMediaIncomingCall(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then((e=>{this.peerCall.answer(e),this.peerCall.on("stream",(e=>{const t=this.$refs.remoteStream;t.srcObject=e,t.onloadedmetadata=()=>{t.play()},console.log("this.vcSetWebRTCstatus(VC_WEBRTC_STATUS_CONNECTED)"),this.vcSetWebRTCstatus(Me.t3)}))})).catch((e=>{console.log(`${e.name}: ${e.message}`)}))},getUserMediaOutgoingCall(){navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:"user"}}).then((e=>{console.log("getUserMediaOutgoingCall mediaStream"),console.log(`calling peer: ${Ue.y.substr(8,2)}-fc-profile-${this.getChatSelectedProfile.id}`),this.peerCall=this.peer.call(`${Ue.y.substr(8,2)}-fc-profile-${this.getChatSelectedProfile.id}-session-${this.getVCcallEntity.session_id_receiver}`,e,this.peerOptions),this.peerCall.on("error",(e=>{this.vcSetError({errorTextArray:[e]})})),this.peerCall.on("close",(()=>{console.log("on close outgoing call")})),this.peerCall.on("stream",(e=>{console.log("outgoing call: this.peerCall.on stream");const t=this.$refs.remoteStream;t.srcObject=e,t.onloadedmetadata=()=>{t.play()},console.log("this.vcSetWebRTCstatus(VC_WEBRTC_STATUS_CONNECTED)"),this.vcSetWebRTCstatus(Me.t3)}))})).catch((e=>{console.log(`${e.name}: ${e.message}`)}))},onCameraToggle(){this.userPrefenceSet({key:"showMyVido",value:!this.getUserVCPreferenceShowMyVideo}),this.getUserVCPreferenceShowMyVideo?this.getUserMediaMyCamera():this.myMediaStream&&this.$refs.videoMyStream&&this.$refs.videoMyStream.srcObject&&(this.$refs.videoMyStream.srcObject=null),this[We.wT]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onMyVideoDrag(e){e.isFirst&&(this.dragPositions.clientX=e.evt.clientX,this.dragPositions.clientY=e.evt.clientY),this.debouncedMoveMyCamera(e.evt),e.isFinal&&this.onMyVideoDragEnd()},onMyVideoDragEnd(){this.userPrefenceSet({key:`divPositionMyVideo_${window.screen.width}x${window.screen.height}`,value:this.myVideoPosition}),this[We.wT]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onRemoteAudioToggle(){this.userPrefenceSet({key:"remoteAudioMuted",value:!this.getUserVCPreferenceRemoteAudioMuted}),this[We.wT]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},onDebugConsoleToggle(){this.userPrefenceSet({key:"showDebugConsole",value:!this.getUserVCPreferenceShowDebugConsole}),this[We.wT]({fields:{user:{preferences:this.getUserPreferenceObject}},token:this.getUserToken})},newPeer(){const e=`${Ue.y.substr(8,2)}-fc-profile-${this.getUserActiveProfileId}-session-${this.getUserSessionId}`;console.log(`newPeer: peerId: ${e}`),this.peer=new(Te())(e,{config:{iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}]},debug:3}),this.peer.on("error",(e=>{this.vcSetError({errorTextArray:[e]})})),this.peer.on("call",(e=>{console.log("incoming call: this.peer.on call"),this.peerCall=e,this.peerCall.on("error",(e=>{this.vcSetError({errorTextArray:[e]})})),this.peerCall.on("close",(()=>{console.log("on close incoming call")})),this.getUserMediaIncomingCall()}))},timeoutFunctionCheckAndHandleWebRTCtimedOut(){console.log("timeoutFunctionCheckAndHandleWebRTCtimedOut"),this.getVCcallStatusIsConnected&&this.getVCwebRTCStatus===Me.zP&&(console.log("WebRTC: times out"),this.vcSetWebRTCstatus(Me.cM),this.onEndCallButton())}},(0,n.nv)(["userPrefenceSet","vcInitComponent","vcResetErrorlist","vcSetCallerStatus","vcSetError","vcSetWebRTCstatus"])),(0,T.$R)([We.wT,Me.$M,Me.eI])),computed:r()({vcReceiverStatusDisplay(){return this.getChatVCReceiverOnlineStatus?this.getChatVCReceiverOnlineStatus:this.getVCReceiverStatusDisplay?this.getVCReceiverStatusDisplay:this.myMediaStream?"":this.$t("vcReceiverStatusDisplay_no_mediastream")}},(0,n.Se)(["getChatSelectedProfile","getChatVCReceiverOnlineStatus","getUserActiveProfileId","getUserPreferenceObject","getUserSessionId","getUserToken","getUserVCPostionMyVideo","getUserVCPreferenceRemoteAudioMuted","getUserVCPreferenceShowDebugConsole","getUserVCPreferenceShowMyVideo","getVCcallEntity","getVCplayRingbacktone","getVCcallerStatus","getVCerrorList","getVCcallIsOutgoing","getVCcallStatusIsConnected","getVCisFetchingReceiverProfile","getVCmodeUseReceivedProfile","getVCReceiverStatusDisplay","getVCwebRTCStatus"])),watch:{getVCplayRingbacktone(e){e?(this.ringbacktone.play(),this.backtoneIsPlaying=!0):this.ringbacktone&&(this.ringbacktone.pause(),this.ringbacktone.currentTime=0,this.backtoneIsPlaying=!1)},getVCcallStatusIsConnected(e,t){console.log(`getVCcallStatusIsConnected: ${this.getVCcallStatusIsConnected}`),e?(setTimeout(this.timeoutFunctionCheckAndHandleWebRTCtimedOut,1e4),this.getVCcallIsOutgoing&&this.getUserMediaOutgoingCall()):t&&(console.log("watch: getVCcallStatusIsConnected: change to not connected"),this.$refs.remoteStream.srcObject&&(this.$refs.remoteStream.srcObject=null),this.call&&this.call.open&&this.call.close(),this.peer&&this.peer.destroy(),this.newPeer())},getVCisFetchingReceiverProfile(e){e?this.loadingIsShowing||(this.$q.loading.show(),this.loadingIsShowing=!0):this.loadingIsShowing&&(this.$q.loading.hide(),this.loadingIsShowing=!1)}},mounted(){this.vcInitComponent(),this.getVCisFetchingReceiverProfile?(this.$q.loading.show(),this.loadingIsShowing=!0):this.getChatSelectedProfile||this.$router.push("/chat"),this.myVideoPosition=this.getUserVCPostionMyVideo,this.debouncedMoveMyCamera=(0,V.debounce)((e=>{e.touches?e.touches[0]&&(this.dragPositions.left=this.dragPositions.clientX-e.touches[0].clientX,this.dragPositions.top=this.dragPositions.clientY-e.touches[0].clientY,this.dragPositions.clientX=e.touches[0].clientX,this.dragPositions.clientY=e.touches[0].clientY):(this.dragPositions.left=this.dragPositions.clientX-e.clientX,this.dragPositions.top=this.dragPositions.clientY-e.clientY,this.dragPositions.clientX=e.clientX,this.dragPositions.clientY=e.clientY),this.$refs.myVideo.offsetTop-this.dragPositions.top>0&&(this.myVideoPosition=r()({},this.myVideoPosition),this.myVideoPosition.top=this.$refs.myVideo.offsetTop-this.dragPositions.top,this.myVideoPosition.left=this.$refs.myVideo.offsetLeft-this.dragPositions.left)}),1,{leading:!1,trailing:!0}),this.getUserVCPreferenceShowMyVideo&&this.getUserMediaMyCamera(),this.newPeer(),console.stdlog||(console.stdlog=console.log.bind(console)),console.log=(...e)=>{console.stdlog(...e),this.logArray&&this.logArray.push(e)}},beforeUnmount(){this.getVCcallerStatus!==Me.lm&&this.onEndCallButton(),this.peer&&this.peer.destroy()}};var Re=o(5777);$e.render=Se,$e.__scopeId="data-v-103dd038";const De=$e;K()($e,"components",{QItem:re.Z,QItemSection:ne.Z,QAvatar:de.Z,QItemLabel:ce.Z,QBadge:O.Z,QBtn:L.Z,QPageSticky:H.Z}),K()($e,"directives",{TouchPan:Re.Z});var qe=o(2920);const Ae={name:"ProfileDetailMain",components:{"profile-detail-info":G,"profile-detail-chat":ue,"profile-detail-videochat":De},data(){return{tabsValue:this.getTabsValue(),settings:qe.Z}},methods:r()({getTabsValue(){let e="info";const{selectedProfileIndex:t}=this.$store.state.chat;if(-1!==t){const o=this.$store.state.chat.profiles[t];(o.is_contact||o.unread_messages_counter)&&(e="chat")}return this.$route.params.tab&&"videochat"===this.$route.params.tab&&(e="videochat"),e}},(0,n.nv)(["vcSetModeUseReceivedProfile"])),computed:r()({},(0,n.Se)(["getVCisFetchingReceiverProfile"])),watch:{getVCisFetchingReceiverProfile(e){e&&(this.tabsValue="videochat")}}};var je=o(7547),Ze=o(3269);Ae.render=l;const Qe=Ae;K()(Ae,"components",{QPage:A.Z,QPageSticky:H.Z,QTabs:je.Z,QTab:Ze.Z})},5784:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=5784,e.exports=t}}]);